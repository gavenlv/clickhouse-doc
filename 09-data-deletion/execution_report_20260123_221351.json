{
  "timestamp": "2026-01-23T22:13:51.143283",
  "directory": "09-data-deletion",
  "summary": {
    "total_files": 7,
    "total_statements": 243,
    "total_success": 236,
    "total_errors": 7
  },
  "results": {
    "09-data-deletion\\01_partition_deletion_examples.sql": [
      {
        "statement": "-- ================================================\n-- 01_partition_deletion_examples.sql\n-- ä» 01_partition_deletion.md æå–çš„ SQL ç¤ºä¾‹\n-- æå–æ—¶é—´: 2026-01-23 14:40:17\n-- =====================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ é™¤å¤šä¸ªåˆ†åŒº\nALTER TABLE table_name\nDROP PARTITION partition_value1, partition_value2, ...",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä½¿ç”¨ DETACH åå†åˆ é™¤ï¼ˆæ›´å®‰å…¨ï¼‰\nALTER TABLE table_name\nDETACH PARTITION partition_value",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- åˆ é™¤ 2023 å¹´ 1 æœˆçš„æ‰€æœ‰æ•°æ®\nALTER TABLE events\nDROP PARTITION '2023-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ é™¤å¤šä¸ªæœˆä»½çš„æ•°æ®\nALTER TABLE events\nDROP PARTITION '2023-01', '2023-02', '2023-03'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æŸ¥çœ‹å½“å‰åˆ†åŒº\nSELECT \n    partition,\n    formatReadableSize(sum(bytes_on_disk)) AS size,\n    sum(rows) AS",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ é™¤æ—©äºç‰¹å®šæ—¥æœŸçš„åˆ†åŒº\nALTER TABLE events\nDROP PARTITION '2023-06'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- åˆ é™¤æµ‹è¯•åˆ†åŒºçš„æ•°æ®\nALTER TABLE events\nDROP PARTITION 'test_2023-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æˆ–ä½¿ç”¨ DETACHï¼ˆä¿ç•™æ•°æ®æ–‡ä»¶ï¼‰\nALTER TABLE events\nDETACH PARTITION 'test_2023-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- é‡æ–°é™„åŠ åˆ†åŒºï¼ˆæ¢å¤æ•°æ®ï¼‰\nALTER TABLE events\nATTACH PARTITION 'test_2023-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æŒ‰æœˆåˆ†åŒº\nPARTITION BY toYYYYMM(event_time)\n-- åˆ†åŒºå€¼: '202301'\n\n-- æŒ‰æ—¥æœŸåˆ†åŒº\nPARTITION BY toDate(event_time)\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- åˆ†æåˆ†åŒºå¤§å°åˆ†å¸ƒ\nSELECT\n    partition,\n    formatReadableSize(sum(bytes_on_disk)) AS size,\n    formatReada",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æŸ¥æ‰¾å¯ä»¥åˆ é™¤çš„æ—§åˆ†åŒºï¼ˆè¶…è¿‡ 90 å¤©ï¼‰\nSELECT\n    partition,\n    toDate(replaceRegexpOne(partition, '^(\\\\d{4})(\\\\d{2}",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- 1. åˆ›å»ºå½’æ¡£è¡¨ï¼ˆä½¿ç”¨ä¸åŒçš„å­˜å‚¨ç­–ç•¥ï¼‰\nCREATE TABLE events_archive AS events\nENGINE = MergeTree\nPARTITION BY toYYYYMM",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. å°†æ—§æ•°æ®ç§»åŠ¨åˆ°å½’æ¡£è¡¨\nINSERT INTO events_archive\nSELECT * FROM events\nWHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 3. éªŒè¯æ•°æ®å·²å¤åˆ¶\nSELECT \n    'events' as table_name,\n    partition,\n    sum(rows) as rows\nFROM system.parts\nWHERE database = 'default' AND table = 'events' AND active = 1\nGROUP BY partition\n\nUNION ALL\n\nS",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 4. åˆ é™¤åŸè¡¨ä¸­çš„æ—§åˆ†åŒº\nALTER TABLE events\nDROP PARTITION '2022-12'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- ä½¿ç”¨åˆ†åŒºäº¤æ¢å¿«é€Ÿåˆ é™¤æ•°æ®ï¼ˆé€‚ç”¨äºä¸´æ—¶è¡¨ï¼‰\n\n-- 1. åˆ›å»ºä¸´æ—¶è¡¨\nCREATE TEMPORARY TABLE temp_delete AS events",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. æ’å…¥è¦ä¿ç•™çš„æ•°æ®\nINSERT INTO temp_delete\nSELECT * FROM events\nWHERE event_time >= '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 3. æ›¿æ¢åˆ†åŒº\nALTER TABLE events\nREPLACE PARTITION '2023-01' FROM temp_delete",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 4. éªŒè¯æ•°æ®\nSELECT count() FROM events",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- å°†æ•°æ®é‡æ–°åˆ†åŒºååˆ é™¤\n\n-- 1. æ·»åŠ ä¸´æ—¶åˆ†åŒºåˆ—\nALTER TABLE events\nADD COLUMN temp_partition String",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. æ ‡è®°è¦åˆ é™¤çš„æ•°æ®\nALTER TABLE events\nUPDATE temp_partition = 'delete' WHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 3. å¼ºåˆ¶åˆå¹¶\nOPTIMIZE TABLE events FINAL",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 4. åˆ é™¤æ ‡è®°çš„åˆ†åŒº\nALTER TABLE events\nDROP PARTITION 'delete'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 5. æ¸…ç†ä¸´æ—¶åˆ—\nALTER TABLE events\nDROP COLUMN temp_partition",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„ ALTER æ“ä½œ\nSELECT\n    database,\n    table,\n    mutation_id,\n    command,\n    is_done,\n    cr",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æ£€æŸ¥åˆ†åŒºæ˜¯å¦å·²åˆ é™¤\nSELECT\n    partition,\n    sum(rows) AS rows,\n    sum(bytes_on_disk) AS bytes\nFROM system",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ£€æŸ¥éæ´»åŠ¨æ•°æ®å—ï¼ˆç­‰å¾…æ¸…ç†ï¼‰\nSELECT\n    partition,\n    name AS part_name,\n    bytes_on_disk,\n    remove_time\nFROM system.parts\nWHERE database = 'your_database'\n  AND table = 'your_table'\n  AND active = 0\nORDER B",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "09-data-deletion\\02_ttl_deletion_examples.sql": [
      {
        "statement": "-- ================================================\n-- 02_ttl_deletion_examples.sql\n-- ä» 02_ttl_deletion.md æå–çš„ SQL ç¤ºä¾‹\n-- æå–æ—¶é—´: 2026-01-23 14:40:17\n-- ================================================\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¸ºç°æœ‰è¡¨æ·»åŠ  TTL\nALTER TABLE table_name\nMODIFY TTL event_time + INTERVAL 90 DAY",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ é™¤ TTL\nALTER TABLE table_name\nREMOVE TTL",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æ•°æ®è¿‡æœŸåè‡ªåŠ¨åˆ é™¤\nCREATE TABLE events (\n    id UInt64,\n    event_time DateTime,\n    data String\n) ENGINE =",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æ•°æ®è¿‡æœŸåç§»åŠ¨åˆ°å½’æ¡£è¡¨\nCREATE TABLE events (\n    id UInt64,\n    event_time DateTime,\n    data String\n) ENGINE",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æ•°æ®è¿‡æœŸåé‡æ–°èšåˆ\nCREATE TABLE events (\n    id UInt64,\n    event_time DateTime,\n    user_id UInt64,\n    va",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- åˆ—æ•°æ®è¿‡æœŸååˆ é™¤æˆ–é‡æ–°è®¡ç®—\nCREATE TABLE events (\n    id UInt64,\n    event_time DateTime,\n    temporary_data Str",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¿®æ”¹åˆ— TTL\nALTER TABLE events\nMODIFY COLUMN temporary_data String TTL event_time + INTERVAL 3 DAY",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- ç®€å•çš„æ—¶é—´åˆ°æœŸåˆ é™¤\nCREATE TABLE logs (\n    event_time DateTime,\n    level String,\n    message String\n) ENGI",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- å¤šä¸ª TTL è§„åˆ™\nCREATE TABLE events (\n    event_time DateTime,\n    event_type String,\n    data String,\n ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- è¡¨å’Œåˆ—åŒæ—¶è®¾ç½® TTL\nCREATE TABLE events (\n    event_time DateTime,\n    data String TTL event_time + INTERV",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- åˆ›å»ºæ—¥å¿—è¡¨\nCREATE TABLE application_logs (\n    timestamp DateTime,\n    level String,\n    service String",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ’å…¥æ•°æ®\nINSERT INTO application_logs VALUES\n    (now(), 'INFO', 'api', 'Request received'),\n    (now() - INTERVAL 31 DAY, 'INFO', 'api', 'Old request')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æŸ¥è¯¢ TTL ä¿¡æ¯\nSELECT\n    database,\n    table,\n    engine_full,\n    ttl_table\nFROM system.tables\nWHERE table = 'application_logs'\\G\n\n-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ============",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æŸ¥çœ‹ç”¨æˆ·çš„ TTL è®¾ç½®\nSELECT\n    user_id,\n    data_retention,\n    TTL_setting\nFROM user_settings",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- é…ç½®å­˜å‚¨ç­–ç•¥\n-- åœ¨ config.xml ä¸­å®šä¹‰å­˜å‚¨ç­–ç•¥\n\n\n-- åˆ›å»ºè¡¨ä½¿ç”¨åˆ†å±‚å­˜å‚¨\nCREATE TABLE events (\n    event_time DateTime,\n    d",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æ—¶åºæ•°æ®èšåˆæ»šåŠ¨\nCREATE TABLE metrics (\n    timestamp DateTime,\n    metric_name String,\n    value Float64,",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æŸ¥çœ‹è¡¨çš„ TTL å®šä¹‰\nSELECT\n    database,\n    table,\n    ttl_table,\n    ttl_definition\nFROM system.tables\nW",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æŸ¥çœ‹å³å°†è¿‡æœŸçš„æ•°æ®\nSELECT\n    event_time,\n    event_time + INTERVAL 90 DAY AS expire_time,\n    dateDiff('da",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- å»¶é•¿ TTL\nALTER TABLE events\nMODIFY TTL event_time + INTERVAL 180 DAY",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ç¼©çŸ­ TTL\nALTER TABLE events\nMODIFY TTL event_time + INTERVAL 30 DAY",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ·»åŠ æ–°çš„ TTL è§„åˆ™\nALTER TABLE events\nMODIFY TTL\n    event_time + INTERVAL 30 DAY,\n    event_time + INTERVAL 7 DAY TO DISK 'archive' WHERE priority = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- ç§»é™¤è¡¨ TTL\nALTER TABLE events\nREMOVE TTL",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ç§»é™¤åˆ— TTL\nALTER TABLE events\nMODIFY COLUMN temporary_data String",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æŸ¥çœ‹ TTL å¤„ç†æ—¥å¿—\nSELECT\n    event_time,\n    event_date,\n    database,\n    table,\n    query,\n    type,\n ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- ç›‘æ§æ•°æ®æ¸…ç†æ•ˆæœ\nSELECT\n    toStartOfDay(event_time) AS day,\n    count() AS rows,\n    count() / NULLIF(LAG",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- é…ç½®å¤šçº§å­˜å‚¨\nCREATE TABLE events (\n    event_time DateTime,\n    data String,\n    size UInt64\n) ENGINE = ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æŸ¥çœ‹æ•°æ®åœ¨å„å±‚çº§çš„åˆ†å¸ƒ\nSELECT\n    CASE\n        WHEN event_time >= now() - INTERVAL 1 DAY THEN 'hot'\n        WHEN event_time >= now() - INTERVAL 7 DAY THEN 'warm'\n        WHEN event_time >= now() - INTERVAL 30",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æ ¹æ®æ•°æ®ä¼˜å…ˆçº§è®¾ç½®ä¸åŒ TTL\nCREATE TABLE notifications (\n    id UInt64,\n    event_time DateTime,\n    priority ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- é«˜ä¼˜å…ˆçº§ 30 å¤©\n\n-- æ’å…¥æ•°æ®\nINSERT INTO notifications VALUES\n    (1, now(), 1, 'Low priority'),\n    (2, now(), 2, 'Medium priority'),\n    (3, now(), 3, 'High priority')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- TTL è‡ªåŠ¨è§¦å‘åˆ†åŒºåˆ é™¤\nCREATE TABLE events (\n    event_time DateTime,\n    data String\n) ENGINE = MergeTree\nP",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "09-data-deletion\\03_mutation_deletion_examples.sql": [
      {
        "statement": "-- ================================================\n-- 03_mutation_deletion_examples.sql\n-- ä» 03_mutation_deletion.md æå–çš„ SQL ç¤ºä¾‹\n-- æå–æ—¶é—´: 2026-01-23 14:40:17\n-- =======================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ›´æ–°æ•°æ®\nALTER TABLE table_name\nUPDATE column = expression WHERE condition",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ç«‹å³æ‰§è¡Œ Mutation\nALTER TABLE table_name\nDELETE WHERE condition\nSETTINGS mutations_sync = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- Mutation æ˜¯å¼‚æ­¥æ‰§è¡Œçš„\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æŸ¥çœ‹æ‰§è¡ŒçŠ¶æ€\nSELECT\n    mutation_id,\n    command,\n    is_done,\n    create_time,\n    done_time,\n    exception_code\nFROM system.mutations\nWHERE database = 'your_database' AND table = 'your_table'\nORDER BY ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- Mutation æ˜¯é‡æ“ä½œï¼Œä¼šè§¦å‘æ•°æ®é‡å†™\n-- æŸ¥çœ‹å—å½±å“çš„è¡Œæ•°\nSELECT\n    mutation_id,\n    command,\n    parts_to_do_names,\n    ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- åˆ é™¤ç‰¹å®šæ¡ä»¶çš„æ•°æ®\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ é™¤å¤šä¸ªæ¡ä»¶\nALTER TABLE events\nDELETE WHERE \n    event_time < '2023-01-01'\n    OR level = 'debug'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä½¿ç”¨å­æŸ¥è¯¢\nALTER TABLE events\nDELETE WHERE user_id IN (\n    SELECT user_id FROM deleted_users\n)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- å°†å¤§åˆ é™¤æ‹†åˆ†ä¸ºå¤šä¸ªå°æ‰¹æ¬¡\n-- æ‰¹æ¬¡ 1\nALTER TABLE events\nDELETE WHERE event_time >= '2022-01-01' AND event_time < '",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ‰¹æ¬¡ 2\nALTER TABLE events\nDELETE WHERE event_time >= '2022-03-01' AND event_time < '2022-05-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ‰¹æ¬¡ 3\nALTER TABLE events\nDELETE WHERE event_time >= '2022-05-01' AND event_time < '2022-07-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æ›´æ–°å•åˆ—\nALTER TABLE events\nUPDATE status = 'archived' WHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä½¿ç”¨è¡¨è¾¾å¼æ›´æ–°\nALTER TABLE events\nUPDATE status = CASE \n    WHEN event_time < '2023-01-01' THEN 'archived'\n    WHEN event_time < '2023-06-01' THEN 'old'\n    ELSE 'current'\nEND",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æ›´æ–°å¤šåˆ—\nALTER TABLE users\nUPDATE \n    last_login = now(),\n    login_count = login_count + 1\nWHERE use",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä½¿ç”¨ Map æ›´æ–°\nALTER TABLE events\nUPDATE tags = mapInsert(tags, 'processed', 'true') WHERE id = 123",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- å¤æ‚æ¡ä»¶æ›´æ–°\nALTER TABLE orders\nUPDATE \n    status = 'cancelled',\n    cancelled_at = now()\nWHERE \n    st",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- åˆ é™¤ç”¨æˆ·çš„æ‰€æœ‰æ•°æ®\nALTER TABLE user_events\nDELETE WHERE user_id = 'user123'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ é™¤ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼ˆä¿ç•™ç»Ÿè®¡ï¼‰\nALTER TABLE users\nUPDATE \n    email = 'deleted@deleted.com',\n    phone = 'deleted',\n    address = 'deleted'\nWHERE user_id = 'user123'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- è®°å½•åˆ é™¤æ“ä½œ\nINSERT INTO data_deletion_log\nSELECT\n    user_id,\n    'delete' as action,\n    now() as timestamp\nFROM users\nWHERE user_id = 'user123'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- ä¿®æ­£é”™è¯¯æ•°æ®\nALTER TABLE orders\nUPDATE total_amount = quantity * unit_price\nWHERE total_amount != quanti",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¿®æ­£æ—¥æœŸæ ¼å¼é”™è¯¯\nALTER TABLE events\nUPDATE event_time = parseDateTimeBestEffort(event_date_str)\nWHERE event_time = toDateTime('1970-01-01')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- è½¯åˆ é™¤ï¼ˆæ ‡è®°è€Œéç‰©ç†åˆ é™¤ï¼‰\nALTER TABLE messages\nUPDATE is_deleted = 1, deleted_at = now()\nWHERE message_id IN (",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æŸ¥çœ‹è½¯åˆ é™¤çš„æ•°æ®\nSELECT * FROM messages WHERE is_deleted = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ¢å¤è½¯åˆ é™¤çš„æ•°æ®\nALTER TABLE messages\nUPDATE is_deleted = 0, deleted_at = NULL\nWHERE message_id = 'msg123'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- å¯¹æ•°æ®è¿›è¡Œèšåˆæ›´æ–°\nALTER TABLE daily_metrics\nUPDATE \n    total_value = sum(value)\nGROUP BY metric_name, dat",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æŸ¥çœ‹æ‰€æœ‰ Mutation\nSELECT\n    database,\n    table,\n    mutation_id,\n    command,\n    is_done,\n    parts",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- ç›‘æ§ Mutation çš„èµ„æºä½¿ç”¨\nSELECT\n    mutation_id,\n    command,\n    formatReadableSize(total_bytes_read_unc",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- é¢„ä¼° Mutation çš„å½±å“\nSELECT\n    'é¢„ä¼°åˆ é™¤è¡Œæ•°' as metric,\n    count() as value\nFROM your_table\nWHERE event_ti",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æ­¥éª¤ 1: é¢„ä¼°å½±å“\nSELECT\n    count() AS rows_to_delete,\n    formatReadableSize(sum(length(data))) AS size",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ­¥éª¤ 2: å¤‡ä»½æ•°æ®\nINSERT INTO events_backup\nSELECT * FROM events\nWHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ­¥éª¤ 3: éªŒè¯å¤‡ä»½\nSELECT count() FROM events_backup",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ­¥éª¤ 4: æ‰§è¡Œåˆ é™¤\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'\nSETTINGS mutations_sync = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ­¥éª¤ 5: éªŒè¯åˆ é™¤\nSELECT count() FROM events WHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ­¥éª¤ 6: æ¸…ç†å¤‡ä»½ï¼ˆå¦‚éœ€è¦ï¼‰\n-- ALTER TABLE events_backup DROP PARTITION '2022-12'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æŒ‰ä¼˜å…ˆçº§åˆ é™¤æ•°æ®\n\n-- å…ˆåˆ é™¤æœ€ä¸é‡è¦çš„æ•°æ®\nALTER TABLE events\nDELETE WHERE priority = 'low' AND event_time < '2023-01",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ç­‰å¾…å®Œæˆ\n-- SELECT is_done FROM system.mutations WHERE command LIKE '%priority = low%'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- å†åˆ é™¤ä¸­ç­‰é‡è¦æ•°æ®\nALTER TABLE events\nDELETE WHERE priority = 'medium' AND event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æœ€ååˆ é™¤é«˜ä¼˜å…ˆçº§æ•°æ®ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰\nALTER TABLE events\nDELETE WHERE priority = 'high' AND event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- å¢é‡åˆ é™¤ç­–ç•¥\n\n-- ç¬¬ä¸€å¤©ï¼šåˆ é™¤æœ€æ—§çš„æ•°æ®\nALTER TABLE events\nDELETE WHERE event_time < '2022-01-01'\nSETTINGS max_thre",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ç¬¬äºŒå¤©ï¼šåˆ é™¤æ¬¡æ—§çš„æ•°æ®\nALTER TABLE events\nDELETE WHERE \n    event_time >= '2022-01-01' \n    AND event_time < '2022-03-01'\nSETTINGS max_threads = 4",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ç¬¬ä¸‰å¤©ï¼šåˆ é™¤æ›´è¿‘çš„æ•°æ®\nALTER TABLE events\nDELETE WHERE \n    event_time >= '2022-03-01' \n    AND event_time < '2022-06-01'\nSETTINGS max_threads = 4",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- å¼‚æ­¥æ‰§è¡Œï¼ˆé»˜è®¤ï¼‰\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åŒæ­¥æ‰§è¡Œï¼ˆç­‰å¾…å®Œæˆï¼‰\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'\nSETTINGS mutations_sync = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åŒæ­¥æ‰§è¡Œæ‰€æœ‰ä¹‹å‰çš„ Mutation\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'\nSETTINGS mutations_sync = 2",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'\nSETTINGS max_threads = 4",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ§åˆ¶å¤åˆ¶çº¿ç¨‹æ•°ï¼ˆå¤åˆ¶è¡¨ï¼‰\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'\nSETTINGS replicated_deduplication_window = 0",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "09-data-deletion\\04_lightweight_deletion_examples.sql": [
      {
        "statement": "-- ================================================\n-- 04_lightweight_deletion_examples.sql\n-- ä» 04_lightweight_deletion.md æå–çš„ SQL ç¤ºä¾‹\n-- æå–æ—¶é—´: 2026-01-23 14:40:17\n-- =================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ç­‰ä»·äº\nALTER TABLE table_name\nDELETE LIGHTWEIGHT WHERE condition",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- è½»é‡çº§åˆ é™¤æ˜¯å¼‚æ­¥çš„\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'\nSETTINGS lightweight_delete = ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ é™¤ä¼šç«‹å³è¿”å›ï¼Œåå°æ‰§è¡Œ\n\n-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- è½»é‡çº§åˆ é™¤ä½¿ç”¨æ ‡è®°æœºåˆ¶\n-- æ•°æ®ä¸ä¼šè¢«ç«‹å³åˆ é™¤ï¼Œè€Œæ˜¯æ ‡è®°ä¸ºå·²åˆ é™¤\n\n-- æŸ¥çœ‹è¢«æ ‡è®°åˆ é™¤çš„æ•°æ®\nSELECT\n    _part,\n    _block_off",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- åˆ é™¤å°‘é‡æ•°æ®ï¼ˆ<10%ï¼‰\nALTER TABLE events\nDELETE WHERE event_id = 12345\nSETTINGS lightweight_delete = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ é™¤ä¸­ç­‰é‡æ•°æ®ï¼ˆ10-30%ï¼‰\nALTER TABLE events\nDELETE WHERE user_id = 'user123'\nSETTINGS lightweight_delete = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- å¿«é€Ÿåˆ é™¤ç”¨æˆ·æ•°æ®\nALTER TABLE user_events\nDELETE WHERE user_id = 'user123'\nSETTINGS lightweight_delete = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "ALTER TABLE user_profile\nDELETE WHERE user_id = 'user123'\nSETTINGS lightweight_delete = 1",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting lightweight_delete is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings: Maybe you meant ['lightweight_delete_mode','l"
      },
      {
        "statement": "-- è®°å½•åˆ é™¤æ“ä½œ\nINSERT INTO data_deletion_log\nVALUES ('user123', now(), 'lightweight_delete')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- å®æ—¶åˆ é™¤è¿‡æœŸæ•°æ®\nCREATE MATERIALIZED VIEW expired_events_mv\nENGINE = MergeTree()\nORDER BY event_id\nAS SELE",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- å®šæœŸæ‰§è¡Œè½»é‡çº§åˆ é™¤\n-- å¯ä»¥é€šè¿‡å¤–éƒ¨è°ƒåº¦å™¨è§¦å‘\nALTER TABLE events\nDELETE WHERE event_time < now() - INTERVAL 90 DAY\nSETTINGS lightweight_delete = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- åˆ é™¤æµ‹è¯•ç¯å¢ƒæ•°æ®\nALTER TABLE events\nDELETE WHERE environment = 'test'\nSETTINGS lightweight_delete = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ é™¤è°ƒè¯•æ•°æ®\nALTER TABLE logs\nDELETE WHERE level = 'debug'\nSETTINGS lightweight_delete = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æŸ¥çœ‹æ´»è·ƒçš„è½»é‡çº§åˆ é™¤\nSELECT\n    query_id,\n    query,\n    elapsed,\n    read_rows,\n    written_rows,\n    memor",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æŸ¥çœ‹è¢«æ ‡è®°åˆ é™¤çš„æ•°æ®\nSELECT\n    _part,\n    _block_offset,\n    count() as deleted_count\nFROM events\nWHERE eve",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- ç›‘æ§è½»é‡çº§åˆ é™¤çš„ç©ºé—´å ç”¨\nSELECT\n    'Active Rows' as metric,\n    sum(rows) as value,\n    formatReadableSize(su",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- ä»ç”¨æˆ·åˆ é™¤åˆ—è¡¨ä¸­è¯»å–è¦åˆ é™¤çš„ç”¨æˆ· ID\n-- å‡è®¾æœ‰ä¸€ä¸ªè¡¨å­˜å‚¨äº†è¦åˆ é™¤çš„ç”¨æˆ·\nCREATE TABLE users_to_delete (\n    user_id String\n) ENGINE ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ’å…¥è¦åˆ é™¤çš„ç”¨æˆ· ID\nINSERT INTO users_to_delete VALUES\n    ('user123'),\n    ('user456'),\n    ('user789')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ‰§è¡Œè½»é‡çº§åˆ é™¤\nALTER TABLE user_events\nDELETE WHERE user_id IN (\n    SELECT user_id FROM users_to_delete\n)\nSETTINGS lightweight_delete = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "ALTER TABLE user_profile\nDELETE WHERE user_id IN (\n    SELECT user_id FROM users_to_delete\n)\nSETTINGS lightweight_delete = 1",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting lightweight_delete is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings: Maybe you meant ['lightweight_delete_mode','l"
      },
      {
        "statement": "-- æ¸…ç©ºåˆ é™¤åˆ—è¡¨\nTRUNCATE TABLE users_to_delete",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- åˆ›å»ºç›‘æ§è§†å›¾\nCREATE VIEW deletion_monitor AS\nSELECT\n    now() as timestamp,\n    'lightweight_delete' as ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- å®šæœŸæŸ¥è¯¢ç›‘æ§æ•°æ®\nSELECT * FROM deletion_monitor\nORDER BY timestamp DESC\nLIMIT 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- è½»é‡çº§åˆ é™¤åªæ˜¯æ ‡è®°æ•°æ®\n-- å®é™…åˆ é™¤éœ€è¦é€šè¿‡åˆå¹¶æ“ä½œ\n\n-- è§¦å‘åˆå¹¶ä»¥æ¸…ç†å·²æ ‡è®°çš„æ•°æ®\nOPTIMIZE TABLE events FINAL",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æˆ–è€…ç­‰å¾…è‡ªç„¶çš„åˆå¹¶è¿‡ç¨‹\n-- å¯ä»¥è°ƒæ•´åˆå¹¶ç­–ç•¥åŠ å¿«åˆå¹¶\n\n-- æŸ¥çœ‹åˆå¹¶è¿›åº¦\nSELECT\n    table,\n    partition,\n    sum(rows) as rows,\n    count() as parts\nFROM system.parts\nWHERE table = 'events' AND active = 1\nGROUP BY table, partition",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- åœ¨æŸ¥è¯¢ä¸­å¯ç”¨\nSELECT * FROM events\nSETTINGS allow_experimental_lightweight_delete = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ‰§è¡Œè½»é‡çº§åˆ é™¤\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'\nSETTINGS lightweight_delete = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- æ£€æŸ¥ ClickHouse ç‰ˆæœ¬\nSELECT version()",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- è½»é‡çº§åˆ é™¤éœ€è¦ ClickHouse 23.8 æˆ–æ›´é«˜ç‰ˆæœ¬\n-- å¦‚æœç‰ˆæœ¬è¿‡ä½ï¼Œä¼šå›é€€åˆ°ä¼ ç»Ÿçš„ Mutation åˆ é™¤\n\n-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- è½»é‡çº§åˆ é™¤ä¸ä¼šç«‹å³é‡Šæ”¾å­˜å‚¨ç©ºé—´\n-- å·²æ ‡è®°åˆ é™¤çš„æ•°æ®ä»ç„¶å ç”¨ç©ºé—´\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- ğŸ“‹ åŸºæœ¬è¯­æ³•\n-- ========================================\n\n-- è½»é‡çº§åˆ é™¤é€‚ç”¨äºåˆ é™¤å°‘é‡æ•°æ®\n-- å¦‚æœåˆ é™¤å¤§é‡æ•°æ®ï¼ˆ>30%ï¼‰ï¼Œåº”è¯¥ä½¿ç”¨åˆ†åŒºåˆ é™¤\n\n-- åˆ¤æ–­æ˜¯å¦åº”è¯¥ä½¿ç”¨è½»é‡çº§åˆ é™¤\nSELECT\n    count() as total_rows,\n    ",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "09-data-deletion\\05_deletion_strategies_examples.sql": [
      {
        "statement": "-- ================================================\n-- 05_deletion_strategies_examples.sql\n-- ä» 05_deletion_strategies.md æå–çš„ SQL ç¤ºä¾‹\n-- æå–æ—¶é—´: 2026-01-23 14:40:17\n-- ===================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¼˜ç‚¹ï¼šè‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ\n-- ç¼ºç‚¹ï¼šåˆ é™¤æœ‰å»¶è¿Ÿ\n\n-- ========================================\n-- SQL Block 2\n-- ========================================\n\n-- æ¯æœˆæ‰§è¡Œä¸€æ¬¡\nALTER TABLE application_logs\nDROP PARTITION '202301'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¼˜ç‚¹ï¼šç«‹å³ç”Ÿæ•ˆï¼Œå®Œå…¨æ§åˆ¶\n-- ç¼ºç‚¹ï¼šéœ€è¦æ‰‹åŠ¨æ‰§è¡Œ\n\n-- ========================================\n-- SQL Block 3\n-- ========================================\n\n-- å¿«é€Ÿåˆ é™¤ç”¨æˆ·æ•°æ®\nALTER TABLE user_events\nDELETE WHERE user_id = 'user12",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "ALTER TABLE user_profile\nDELETE WHERE user_id = 'user123'\nSETTINGS lightweight_delete = 1",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting lightweight_delete is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings: Maybe you meant ['lightweight_delete_mode','l"
      },
      {
        "statement": "-- ä¼˜ç‚¹ï¼šå¿«é€Ÿï¼Œæ€§èƒ½å½±å“å°\n-- ç¼ºç‚¹ï¼šéœ€è¦ ClickHouse 23.8+\n\n-- ========================================\n-- SQL Block 4\n-- ========================================\n\nALTER TABLE user_events\nDELETE WHERE user_id = 'user12",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "ALTER TABLE user_profile\nDELETE WHERE user_id = 'user123'",
        "success": false,
        "result": "HTTP 404: Code: 60. DB::Exception: Could not find table: user_profile. (UNKNOWN_TABLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- ä¼˜ç‚¹ï¼šå…¼å®¹æ‰€æœ‰ç‰ˆæœ¬\n-- ç¼ºç‚¹ï¼šæ€§èƒ½å½±å“å¤§\n\n-- ========================================\n-- SQL Block 5\n-- ========================================\n\n-- é…ç½®åˆ†å±‚å­˜å‚¨\nCREATE TABLE events (\n    event_time DateTime,\n    data Stri",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¼˜ç‚¹ï¼šè‡ªåŠ¨ç§»åŠ¨ï¼Œæ•°æ®ä¿ç•™\n-- ç¼ºç‚¹ï¼šéœ€è¦é…ç½®å­˜å‚¨ç­–ç•¥\n\n-- ========================================\n-- SQL Block 6\n-- ========================================\n\n-- 1. å¯¼å‡ºæ•°æ®åˆ°å½’æ¡£è¡¨\nINSERT INTO events_archive\nSELECT * FROM events\nW",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. åˆ é™¤åŸè¡¨æ•°æ®\nALTER TABLE events\nDROP PARTITION '2022-12'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¼˜ç‚¹ï¼šçµæ´»ï¼Œå®Œå…¨æ§åˆ¶\n-- ç¼ºç‚¹ï¼šéœ€è¦æ‰‹åŠ¨æ“ä½œ\n\n-- ========================================\n-- SQL Block 7\n-- ========================================\n\n-- åˆ é™¤æµ‹è¯•æ•°æ®\nALTER TABLE events\nDELETE WHERE environment = 'test'\nSETTI",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¼˜ç‚¹ï¼šå¿«é€Ÿï¼Œä¸å½±å“ç”Ÿäº§æ•°æ®\n-- ç¼ºç‚¹ï¼šéœ€è¦ ClickHouse 23.8+\n\n-- ========================================\n-- SQL Block 8\n-- ========================================\n\nALTER TABLE events\nDELETE WHERE environment = 'test'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¼˜ç‚¹ï¼šå…¼å®¹æ‰€æœ‰ç‰ˆæœ¬\n-- ç¼ºç‚¹ï¼šæ€§èƒ½å½±å“å¤§\n\n-- ========================================\n-- SQL Block 9\n-- ========================================\n\n-- æ‰¹é‡åˆ é™¤åˆ†åŒº\nALTER TABLE events\nDROP PARTITION '2022-01', '2022-02', '202",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¼˜ç‚¹ï¼šæœ€å¿«ï¼Œæ•ˆç‡æœ€é«˜\n-- ç¼ºç‚¹ï¼šåªèƒ½æŒ‰åˆ†åŒºåˆ é™¤\n\n-- ========================================\n-- SQL Block 10\n-- ========================================\n\n-- 1. é‡æ–°åˆ†åŒºä»¥æ”¯æŒæŒ‰æ—¥æœŸåˆ é™¤\nALTER TABLE events\nMODIFY PARTITION BY toYYYYMM",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. ç­‰å¾…åˆå¹¶å®Œæˆ\nOPTIMIZE TABLE events FINAL",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 3. åˆ é™¤æ—§åˆ†åŒº\nALTER TABLE events\nDROP PARTITION '2022-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¼˜ç‚¹ï¼šå¯ä»¥ç²¾ç¡®æ§åˆ¶\n-- ç¼ºç‚¹ï¼šé‡æ–°åˆ†åŒºéœ€è¦æ—¶é—´\n\n-- ========================================\n-- SQL Block 11\n-- ========================================\n\n-- ä¼°ç®—åˆ é™¤çš„å½±å“\nSELECT\n    'æ€»è¡Œæ•°' as metric,\n    count() as value\nFROM e",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 12\n-- ========================================\n\n-- æ ¹æ®åˆ é™¤æ¯”ä¾‹æ¨èæ–¹æ³•\nSELECT\n    CASE \n        WHEN delete_percentage < 10 THEN 'è½»é‡çº§åˆ é™¤'\n        WHEN de",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 13\n-- ========================================\n\n-- ä½¿ç”¨ TTL è‡ªåŠ¨åˆ é™¤ï¼Œä½†æ‰‹åŠ¨æ§åˆ¶å…³é”®æ•°æ®\n\n-- åˆ›å»ºè¡¨\nCREATE TABLE events (\n    event_time DateTime,\n    event_type ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åªåˆ é™¤éå…³é”®æ•°æ®\n\n-- å®šæœŸæ‰‹åŠ¨æ¸…ç†å…³é”®æ•°æ®\nALTER TABLE events\nDELETE WHERE \n    is_critical = 1 \n    AND event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 14\n-- ========================================\n\n-- ä½¿ç”¨åˆ†åŒºåˆ é™¤åˆ é™¤å¤§éƒ¨åˆ†æ•°æ®ï¼Œç”¨ Mutation åˆ é™¤å°‘é‡æ•°æ®\n\n-- 1. åˆ é™¤æ•´ä¸ªæ—§åˆ†åŒº\nALTER TABLE events\nDROP PARTITION '2022-12'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. å¯¹æœ€è¿‘åˆ†åŒºè¿›è¡Œç²¾ç¡®åˆ é™¤\nALTER TABLE events\nDELETE WHERE \n    event_time >= '2023-01-01'\n    AND event_time < '2023-01-15'\n    AND user_id = 'deleted_user'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 15\n-- ========================================\n\n-- ä½¿ç”¨è½»é‡çº§åˆ é™¤æ ‡è®°æ•°æ®ï¼Œå®šæœŸ OPTIMIZE æ¸…ç†\n\n-- 1. æ ‡è®°åˆ é™¤\nALTER TABLE events\nDELETE WHERE event_time < '2023-01",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. å®šæœŸè§¦å‘åˆå¹¶æ¸…ç†å·²æ ‡è®°çš„æ•°æ®\n-- å¯ä»¥é€šè¿‡è°ƒåº¦å™¨æ¯å¤©æ‰§è¡Œä¸€æ¬¡\nOPTIMIZE TABLE events PARTITION '2022-12' FINAL",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 16\n-- ========================================\n\n-- æ€»æ˜¯ä¼˜å…ˆè€ƒè™‘åˆ†åŒºåˆ é™¤\n-- å®ƒæ˜¯æœ€å¿«ã€æœ€é«˜æ•ˆçš„æ–¹æ³•\n\n-- æ£€æŸ¥èƒ½å¦æŒ‰åˆ†åŒºåˆ é™¤\nSELECT \n    partition,\n    toDate(replaceRegexpOne(p",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 17\n-- ========================================\n\n-- ä¸ºå›ºå®šçš„ä¿ç•™ç­–ç•¥è®¾ç½® TTL\n-- ä½†è¦æ³¨æ„åˆ é™¤å»¶è¿Ÿ\n\n-- æŸ¥çœ‹å½“å‰çš„ TTL è®¾ç½®\nSELECT \n    database,\n    table,\n    ttl_table\nF",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 18\n-- ========================================\n\n-- å°†å¤§åˆ é™¤æ‹†åˆ†ä¸ºå¤šä¸ªå°æ‰¹æ¬¡\n\n-- ç¬¬ä¸€æ‰¹æ¬¡\nALTER TABLE events\nDELETE WHERE \n    event_time >= '2022-01-01' \n    A",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ç­‰å¾…å®Œæˆ\nSELECT is_done FROM system.mutations\nWHERE command LIKE '%2022-01-01%' AND command LIKE '%2022-03-01%'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ç¬¬äºŒæ‰¹æ¬¡\nALTER TABLE events\nDELETE WHERE \n    event_time >= '2022-03-01' \n    AND event_time < '2022-05-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 19\n-- ========================================\n\n-- ç›‘æ§åˆ é™¤æ“ä½œçš„æ‰§è¡Œæƒ…å†µ\nSELECT\n    mutation_id,\n    command,\n    is_done,\n    create_time,\n    done_time",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 20\n-- ========================================\n\n-- åˆ é™¤å‰æ€»æ˜¯å¤‡ä»½æ•°æ®\n\n-- 1. åˆ›å»ºå¤‡ä»½è¡¨\nCREATE TABLE events_backup AS events",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. å¤‡ä»½è¦åˆ é™¤çš„æ•°æ®\nINSERT INTO events_backup\nSELECT * FROM events\nWHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 3. éªŒè¯å¤‡ä»½\nSELECT count() FROM events_backup",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 4. æ‰§è¡Œåˆ é™¤\nALTER TABLE events\nDROP PARTITION '2022-12'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 5. åˆ é™¤å¤‡ä»½ï¼ˆå¦‚éœ€è¦ï¼‰\n-- DROP TABLE events_backup",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 21\n-- ========================================\n\n-- âŒ é”™è¯¯ï¼šåˆ é™¤ 50% çš„æ•°æ®ä½¿ç”¨ Mutation\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- âœ… æ­£ç¡®ï¼šä½¿ç”¨åˆ†åŒºåˆ é™¤\nALTER TABLE events\nDROP PARTITION '2022-12'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 23\n-- ========================================\n\n-- âŒ é”™è¯¯ï¼šæ‰§è¡Œåˆ é™¤åä¸æ£€æŸ¥çŠ¶æ€\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- âœ… æ­£ç¡®ï¼šç›‘æ§åˆ é™¤è¿›åº¦\nSELECT \n    is_done,\n    parts_to_do,\n    parts_done,\n    parts_to_do - parts_done AS remaining_parts\nFROM system.mutations\nWHERE command LIKE '%event_time < 2023-01-01%'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 24\n-- ========================================\n\n-- âŒ é”™è¯¯ï¼šç›´æ¥åˆ é™¤ä¸å¤‡ä»½\nALTER TABLE events\nDROP PARTITION '2022-12'",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "09-data-deletion\\06_deletion_performance_examples.sql": [
      {
        "statement": "-- ================================================\n-- 06_deletion_performance_examples.sql\n-- ä» 06_deletion_performance.md æå–çš„ SQL ç¤ºä¾‹\n-- æå–æ—¶é—´: 2026-01-23 14:40:17\n-- =================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ’å…¥ 1 äº¿è¡Œæµ‹è¯•æ•°æ®\nINSERT INTO performance_test\nSELECT \n    number,\n    toDateTime('2023-01-01 00:00:00') + toIntervalMinute(number),\n    repeat('data', 10)\nFROM numbers(100000000)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æµ‹è¯•ä¸åŒåˆ é™¤æ–¹æ³•çš„æ€§èƒ½\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- æœ€å¿«çš„åˆ é™¤æ–¹æ³•\n\n-- æŸ¥çœ‹åˆ†åŒºä¿¡æ¯\nSELECT\n    partition,\n    formatReadableSize(sum(bytes_on_dis",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ é™¤æ•´ä¸ªåˆ†åŒº\nALTER TABLE performance_test\nDROP PARTITION '202301'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ€§èƒ½ï¼šâ­â­â­â­â­ æå¿«\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- å°†å¤§åˆ é™¤æ‹†åˆ†ä¸ºå¤šä¸ªå°æ‰¹æ¬¡\n\n-- æŸ¥çœ‹è¦åˆ é™¤çš„æ•°æ®é‡\nSELECT\n    count() AS total_rows,\n    count() / 10 AS",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ† 10 æ‰¹æ¬¡åˆ é™¤\n-- æ‰¹æ¬¡ 1\nALTER TABLE performance_test\nDELETE WHERE \n    event_time >= '2023-01-01' \n    AND event_time < '2023-01-15'\nSETTINGS max_threads = 4",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ç­‰å¾…å®Œæˆ\n-- SELECT is_done FROM system.mutations WHERE ...\n\n-- æ‰¹æ¬¡ 2\nALTER TABLE performance_test\nDELETE WHERE \n    event_time >= '2023-01-15' \n    AND event_time < '2023-02-01'\nSETTINGS max_threads = 4",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ€§èƒ½æå‡ï¼šå‡å°‘å•æ¬¡æ“ä½œçš„ I/O å’Œ CPU å³°å€¼\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- é™åˆ¶å¹¶å‘çº¿ç¨‹æ•°ä»¥å‡å°‘ç³»ç»Ÿè´Ÿè½½\n\n-- ä½¿ç”¨è¾ƒå°‘çš„çº¿ç¨‹\nALTER TABLE performance_test\nDELETE WHE",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä½¿ç”¨æ›´å¤šçº¿ç¨‹ï¼ˆå¦‚æœç³»ç»Ÿè´Ÿè½½ä½ï¼‰\nALTER TABLE performance_test\nDELETE WHERE event_time < '2023-03-01'\nSETTINGS max_threads = 8",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- å»ºè®®ï¼šæ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- è°ƒæ•´åˆå¹¶ç­–ç•¥ä»¥ä¼˜åŒ–åˆ é™¤åçš„æ€§èƒ½\n\n-- æŸ¥çœ‹å½“å‰åˆå¹¶è®¾ç½®\nSELECT\n    name,\n    value,\n    changed\nFROM syst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- è°ƒæ•´åˆå¹¶å‚æ•°\nSET max_bytes_to_merge_at_once = 10737418240",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 10GB\nSET max_rows_to_merge_at_once = 1000000",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 100 ä¸‡è¡Œ\n\n-- åˆ é™¤åè§¦å‘åˆå¹¶\nOPTIMIZE TABLE performance_test FINAL",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œåˆ é™¤æ“ä½œ\n\n-- æŸ¥çœ‹å½“å‰ç³»ç»Ÿè´Ÿè½½\nSELECT\n    metric,\n    value,\n    description\nFROM system.asynchronous",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- å»ºè®®åœ¨ä»¥ä¸‹æ—¶é—´æ‰§è¡Œï¼š\n-- - å‡Œæ™¨ 2-6 ç‚¹ï¼ˆä¸šåŠ¡ä½å³°ï¼‰\n-- - å‘¨æœ«\n-- - èŠ‚å‡æ—¥\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- å®æ—¶ç›‘æ§åˆ é™¤æ“ä½œ\nSELECT\n    query_id,\n    user,\n    ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- ç›‘æ§åˆ é™¤æœŸé—´çš„ç³»ç»Ÿèµ„æºä½¿ç”¨\nSELECT\n    'CPU' as metric,\n    (sum(OSUserTime) + sum(OSSystemTime)) / sum(OSIdle",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- ç›‘æ§ Mutation æ‰§è¡Œè¿›åº¦\nSELECT\n    mutation_id,\n    command,\n    is_done,\n    parts_to_do,\n    parts_do",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- åˆ›å»ºè¡¨æ—¶è®¾ç½®ä¼˜åŒ–å‚æ•°\nCREATE TABLE optimized_table (\n    id UInt64,\n    event_time DateTime,\n    data Strin",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2GB\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- åœ¨æŸ¥è¯¢ä¸­è®¾ç½®ä¼˜åŒ–å‚æ•°\nALTER TABLE performance_test\nDELETE WHERE event_time < '2023-03-01'\nSETTINGS\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- 1. å…ˆåˆ é™¤å¤§éƒ¨åˆ†æ•°æ®ï¼ˆä½¿ç”¨åˆ†åŒºåˆ é™¤ï¼‰\nALTER TABLE events\nDROP PARTITION '2022-12'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. å†åˆ é™¤å°‘é‡æ•°æ®ï¼ˆä½¿ç”¨ Mutationï¼‰\nALTER TABLE events\nDELETE WHERE \n    event_time >= '2023-01-01'\n    AND event_time < '2023-01-15'\n    AND user_id = 'deleted_user'\nSETTINGS max_threads = 2",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ€§èƒ½ï¼šåˆ†åŒºåˆ é™¤ + å°‘é‡ Mutation = æœ€ä¼˜æ€§èƒ½\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- 1. ä½¿ç”¨è½»é‡çº§åˆ é™¤æ ‡è®°æ•°æ®\nALTER TABLE events\nDELETE WHERE event_time < '20",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. å®šæœŸè§¦å‘åˆå¹¶æ¸…ç†å·²æ ‡è®°çš„æ•°æ®\n-- å¯ä»¥é€šè¿‡ cron æ¯å¤©æ‰§è¡Œ\nOPTIMIZE TABLE events PARTITION '2022-12' FINAL\nSETTINGS max_threads = 4",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ€§èƒ½ï¼šè½»é‡çº§åˆ é™¤ï¼ˆå¿«é€Ÿï¼‰+ å®šæœŸ OPTIMIZEï¼ˆåå°æ¸…ç†ï¼‰\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- 1. åˆ›å»ºç‰©åŒ–è§†å›¾æ•è·åˆ é™¤æ“ä½œ\nCREATE MATERIALIZED VIEW delete_operations_l",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. ç›‘æ§åˆ é™¤æ“ä½œ\nSELECT\n    toStartOfHour(timestamp) AS hour,\n    count() AS delete_operations,\n    avg(elapsed_seconds) AS avg_duration\nFROM delete_operations_log\nWHERE timestamp >= now() - INTERVAL 24 H",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 3. æ ¹æ®ç›‘æ§æ•°æ®ä¼˜åŒ–åˆ é™¤ç­–ç•¥\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- ClickHouse 23.8+ ä½¿ç”¨è½»é‡çº§åˆ é™¤\nALTER TABLE events\nDELETE WHERE event_time < '2023-",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ€§èƒ½æå‡ï¼š3-5 å€\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- é™åˆ¶å¹¶å‘çº¿ç¨‹æ•°\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'\nSETTINGS max_th",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ€§èƒ½å½±å“ï¼šå‡å°‘ CPU å’Œ I/O å³°å€¼\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- ç¡®ä¿åˆ é™¤æ¡ä»¶ä½¿ç”¨ç´¢å¼•\n\n-- æŸ¥çœ‹è¡¨çš„æ’åºé”®\nSELECT \n    name AS table,\n    sorting_key\nFROM ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä¼˜åŒ–ï¼šä½¿åˆ é™¤æ¡ä»¶ä¸æ’åºé”®åŒ¹é…\nALTER TABLE events\nDELETE WHERE \n    event_time < '2023-01-01'  -- event_time æ˜¯æ’åºé”®\n    AND user_id = 'user123'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ€§èƒ½æå‡ï¼šå‡å°‘æ‰«æçš„æ•°æ®é‡\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- âŒ é¿å…ï¼šå…¨è¡¨æ‰«æ\nALTER TABLE events\nDELETE WHERE data LIKE '%test%'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- âœ… æ¨èï¼šä½¿ç”¨åˆ†åŒºè£å‰ª\nALTER TABLE events\nDELETE WHERE \n    partition = '202301'  -- åªæ‰«æç‰¹å®šåˆ†åŒº\n    AND data LIKE '%test%'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ€§èƒ½æå‡ï¼šåªæ‰«æéœ€è¦çš„åˆ†åŒº\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- è®¾ç½® TTL è‡ªåŠ¨æ¸…ç†\nALTER TABLE events\nMODIFY TTL event_time + INTERVAL 90 DAY",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- æ€§èƒ½ä¼˜åŠ¿ï¼šè‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- âŒ é™·é˜±ï¼šä¸€æ¬¡æ€§åˆ é™¤å¤§é‡æ•°æ®\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- åˆ é™¤ 50% çš„æ•°æ®\n\n-- å½±å“ï¼šç³»ç»Ÿè´Ÿè½½é«˜ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¸‹é™\n\n-- âœ… è§£å†³ï¼šåˆ†æ‰¹æ¬¡åˆ é™¤\n-- ï¼ˆå‚è€ƒä¸Šé¢çš„æ‰¹æ¬¡åˆ é™¤è„šæœ¬ï¼‰\n\n-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- âŒ é™·é˜±ï¼šä¸é™åˆ¶çº¿ç¨‹æ•°\nALTER TABLE event",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ä½¿ç”¨æ‰€æœ‰å¯ç”¨çº¿ç¨‹ï¼ˆå¯èƒ½ 16+ï¼‰\n\n-- å½±å“ï¼šCPU ä½¿ç”¨ç‡ 100%\n\n-- âœ… è§£å†³ï¼šé™åˆ¶çº¿ç¨‹æ•°\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'\nSETTINGS max_threads = 4",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- åˆ é™¤æ–¹æ³•æ€§èƒ½å¯¹æ¯”\n-- ========================================\n\n-- âŒ é™·é˜±ï¼šæ‰§è¡Œåä¸ç›‘æ§\nALTER TABLE events\nDELETE WHERE event_time < '2023-01-01'",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "09-data-deletion\\07_deletion_monitoring_examples.sql": [
      {
        "statement": "-- ================================================\n-- 07_deletion_monitoring_examples.sql\n-- ä» 07_deletion_monitoring.md æå–çš„ SQL ç¤ºä¾‹\n-- æå–æ—¶é—´: 2026-01-23 14:40:17\n-- ===================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- æŸ¥çœ‹ Mutation æ‰§è¡Œè¿›åº¦\nSELECT\n    database,\n    table,\n    mutation_id,\n    command,\n    is_done,\n   ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- ç›‘æ§åˆ é™¤æœŸé—´çš„ç³»ç»Ÿèµ„æº\nSELECT\n    'CPU Usage (%)' as metric,\n    round(\n        (sum(OSUserTime) + sum(OSS",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- ç»Ÿè®¡åˆ é™¤æ“ä½œçš„æ‰§è¡Œæƒ…å†µ\nSELECT\n    toStartOfDay(event_time) AS day,\n    count() AS delete_count,\n    avg(el",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- åˆ†æåˆ é™¤æ“ä½œå¯¹è¡¨çš„å½±å“\nSELECT\n    database,\n    table,\n    count() AS delete_operations,\n    avg(parts_to_",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- ç›‘æ§åˆ é™¤æ“ä½œä¸­çš„é”™è¯¯\nSELECT\n    event_time,\n    event_date,\n    database,\n    table,\n    query,\n    excep",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- ç›‘æ§ TTL åˆ é™¤æ‰§è¡Œæƒ…å†µ\nSELECT\n    event_time,\n    database,\n    table,\n    query,\n    elapsed,\n    read_",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- ç›‘æ§åˆ†åŒºåˆ é™¤æ“ä½œ\nSELECT\n    event_time,\n    database,\n    table,\n    query,\n    elapsed\nFROM system.que",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- åˆ›å»ºç›‘æ§è§†å›¾ä¾› Grafana æŸ¥è¯¢\n\n-- 1. åˆ é™¤æ“ä½œæ‰§è¡Œæ—¶é—´è§†å›¾\nCREATE MATERIALIZED VIEW deletion_metrics_mv\nENGINE = Summ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. Mutation çŠ¶æ€è§†å›¾\nCREATE MATERIALIZED VIEW mutation_status_mv\nENGINE = ReplacingMergeTree()\nORDER BY mutation_id\nAS\nSELECT\n    mutation_id,\n    database,\n    table,\n    command,\n    is_done,\n    par",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- å¯¼å‡ºåˆ é™¤æ“ä½œçš„æŒ‡æ ‡\nSELECT\n    'clickhouse_deletions_total' as metric_name,\n    count() as metric_value,\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- æ£€æŸ¥æ‰§è¡Œæ—¶é—´è¿‡é•¿çš„åˆ é™¤æ“ä½œ\nSELECT\n    'Long running deletion' as alert_type,\n    query_id,\n    elapsed,\n    ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- å‘Šè­¦çº§åˆ«ï¼šWARNING\n-- å¤„ç†å»ºè®®ï¼šæ£€æŸ¥åˆ é™¤çš„æ•°æ®é‡ï¼Œè€ƒè™‘åˆ†æ‰¹æ¬¡å¤„ç†\n\n-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- æ£€æŸ¥ç§¯å‹çš„ Mutation\nSELECT\n    'Mutation backlog' as alert",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- å‘Šè­¦çº§åˆ«ï¼š\n-- - 1-2: INFO\n-- - 3-5: WARNING\n-- - >5: CRITICAL\n\n-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- æ£€æŸ¥åˆ é™¤æ“ä½œçš„é”™è¯¯ç‡\nSELECT\n    'High deleti",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- å‘Šè­¦çº§åˆ«ï¼š\n-- - >1%: WARNING\n-- - >5%: CRITICAL\n\n-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- æ£€æŸ¥åˆ é™¤åå­˜å‚¨ç©ºé—´æ˜¯å¦é‡Šæ”¾\nSELECT\n    'Storage not released' ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- > 1GB\n\n-- å‘Šè­¦çº§åˆ«ï¼šWARNING\n-- å¤„ç†å»ºè®®ï¼šè§¦å‘ OPTIMIZE æ¸…ç†éæ´»åŠ¨æ•°æ®å—\n\n-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- è¯Šæ–­åˆ é™¤æ“ä½œçš„æ€§èƒ½é—®é¢˜\nSELECT\n    query_id,\n    el",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- æŸ¥çœ‹å¤±è´¥çš„ Mutation\nSELECT\n    mutation_id,\n    database,\n    table,\n    command,\n    is_done,\n    c",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- è¯„ä¼°åˆ é™¤æ“ä½œçš„å½±å“èŒƒå›´\nSELECT\n    database,\n    table,\n    mutation_id,\n    command,\n    parts_to_do,\n    ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- ç›‘æ§æ‰¹é‡åˆ é™¤çš„è¿›åº¦å’Œæ€§èƒ½\n\n-- 1. æŸ¥çœ‹å½“å‰æ‰¹æ¬¡\nSELECT\n    mutation_id,\n    command,\n    is_done,\n    parts_to_do,\n ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. æŸ¥çœ‹å†å²æ‰¹æ¬¡ç»Ÿè®¡\nSELECT\n    toStartOfHour(create_time) AS hour,\n    count() AS batches_completed,\n    avg(elapsed_seconds) AS avg_batch_duration,\n    sum(elapsed_seconds) AS total_duration\nFROM system.m",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- ç›‘æ§ TTL è‡ªåŠ¨åˆ é™¤çš„æ•ˆæœ\n\n-- 1. æŸ¥çœ‹è¡¨çš„æ•°æ®è¶‹åŠ¿\nSELECT\n    toStartOfDay(event_time) AS day,\n    count() AS row_c",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. æŸ¥çœ‹åˆ†åŒºæ•°é‡å˜åŒ–\nSELECT\n    toStartOfDay(modification_time) AS day,\n    count() AS partition_count\nFROM system.parts\nWHERE table = 'events' AND active = 1\nGROUP BY day\nORDER BY day",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- ç›‘æ§åˆ é™¤æ“ä½œå¯¹ç³»ç»Ÿå¥åº·çš„å½±å“\n\n-- 1. æŸ¥çœ‹å½“å‰è´Ÿè½½\nSELECT\n    'CPU Usage (%)',\n    round(\n        (OSUserTime + OSSys",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- åˆ é™¤æ“ä½œæ¦‚è§ˆ\nSELECT\n    'Today' as period,\n    count() as total_deletions,\n    avg(elapsed) as avg_du",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- Mutation çŠ¶æ€æ¦‚è§ˆ\nSELECT\n    'Active' as status,\n    count() as mutation_count,\n    sum(parts_to_do",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- å®æ—¶ç›‘æ§åˆ é™¤æ“ä½œ\n-- ä½¿ç”¨ clickhouse-client çš„ --interactive é€‰é¡¹\n\nclickhouse-client --host=localhost --port=",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- åˆ†æå†å²åˆ é™¤æ“ä½œ\nSELECT\n    toStartOfWeek(event_time) AS week,\n    count() AS deletion_count,\n    avg(e",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. åˆ é™¤æ“ä½œç›‘æ§\n-- ========================================\n\n-- é¢„æµ‹æœªæ¥çš„åˆ é™¤éœ€æ±‚\nSELECT\n    'Estimated deletions next week' as metric,\n    round(avg(deletion_count)) ",
        "success": true,
        "result": "Comment - skipped"
      }
    ]
  }
}