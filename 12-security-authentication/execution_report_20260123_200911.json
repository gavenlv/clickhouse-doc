{
  "timestamp": "2026-01-23T20:09:11.884351",
  "directory": "12-security-authentication",
  "summary": {
    "total_files": 9,
    "total_statements": 447,
    "total_success": 383,
    "total_errors": 64
  },
  "results": {
    "12-security-authentication\\01_authentication_examples.sql": [
      {
        "statement": "-- ================================================\n-- 01_authentication_examples.sql\n-- 从 01_authentication.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- =============================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建普通用户\nCREATE USER IF NOT EXISTS readonly_user\nIDENTIFIED WITH sha256_password BY 'ReadOnly123!'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建用户并指定默认角色\nCREATE USER IF NOT EXISTS analyst\nIDENTIFIED WITH sha256_password BY 'Analyst123!'\nDEFAULT ROLE analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 创建 SHA-256 密码用户\n-- ========================================\n\n-- 创建使用 Double SHA-1 密码的用户\nCREATE USER IF NOT EXISTS mysql_compatible_user\nIDENTIFIED WITH d",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 创建 SHA-256 密码用户\n-- ========================================\n\n-- 创建使用明文密码的用户（仅用于测试）\nCREATE USER IF NOT EXISTS test_user\nIDENTIFIED WITH plaintext_password",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 或者在 users.xml 中\n<test_user>\n    <password>TestPassword123!</password>\n</test_user>\n\n-- ========================================\n-- 创建 SHA-256 密码用户\n-- ========================================\n\n-- 创建",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 为 LDAP 用户分配角色\nCREATE ROLE IF NOT EXISTS ldap_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON *.* TO ldap_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT ldap_role TO ldap_user",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `ldap_user` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- ========================================\n-- 创建 SHA-256 密码用户\n-- ========================================\n\n-- 创建 Kerberos 认证的用户\nCREATE USER IF NOT EXISTS kerberos_user\nIDENTIFIED WITH kerberos\nSERVER",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 为 Kerberos 用户分配角色\nCREATE ROLE IF NOT EXISTS kerberos_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON *.* TO kerberos_role",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `kerberos_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT kerberos_role TO kerberos_user",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `kerberos_user` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- ========================================\n-- 创建 SHA-256 密码用户\n-- ========================================\n\n-- 创建使用 SSL 证书认证的用户\nCREATE USER IF NOT EXISTS cert_user\nIDENTIFIED WITH ssl_certificate CN '",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 为证书用户分配角色\nCREATE ROLE IF NOT EXISTS cert_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT, INSERT ON *.* TO cert_role",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `cert_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT cert_role TO cert_user",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `cert_user` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- ========================================\n-- 创建 SHA-256 密码用户\n-- ========================================\n\n-- 创建管理员用户（SHA-256 密码）\nCREATE USER IF NOT EXISTS admin\nIDENTIFIED WITH sha256_password BY 'A",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建 LDAP 用户\nCREATE USER IF NOT EXISTS ldap_analyst\nIDENTIFIED WITH ldap_server 'company_ldap'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建 Kerberos 用户\nCREATE USER IF NOT EXISTS kerberos_user\nIDENTIFIED WITH kerberos\nSERVER 'kerberos'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建证书用户\nCREATE USER IF NOT EXISTS cert_user\nIDENTIFIED WITH ssl_certificate CN 'analyst1'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建角色\nCREATE ROLE IF NOT EXISTS admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS analyst_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS readonly_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 分配权限\nGRANT ALL ON *.* TO admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT, INSERT ON *.* TO analyst_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT SELECT ON *.* TO readonly_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 分配角色\nGRANT admin_role TO admin",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT analyst_role TO ldap_analyst",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `ldap_analyst` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT analyst_role TO kerberos_user",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `kerberos_user` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT analyst_role TO cert_user",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `cert_user` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      }
    ],
    "12-security-authentication\\02_user_role_management_examples.sql": [
      {
        "statement": "-- ================================================\n-- 02_user_role_management_examples.sql\n-- 从 02_user_role_management.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- =================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建用户并指定默认角色\nCREATE USER IF NOT EXISTS bob\nIDENTIFIED WITH sha256_password BY 'BobPassword123!'\nDEFAULT ROLE analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建用户并指定多个默认角色\nCREATE USER IF NOT EXISTS charlie\nIDENTIFIED WITH sha256_password BY 'CharliePassword123!'\nDEFAULT ROLE readonly_role, analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建管理员用户\nCREATE USER IF NOT EXISTS admin\nIDENTIFIED WITH sha256_password BY 'AdminPassword123!'\nDEF",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建带 IP 限制的用户\nCREATE USER IF NOT EXISTS restricted_user\nIDENTIFIED WITH sha256_password BY 'RestrictedPassword123!'\nHOST IP '192.168.1.0/24'\nHOST LOCAL",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建带 SQL 限制的用户\nCREATE USER IF NOT EXISTS readonly_user\nIDENTIFIED WITH sha256_password BY 'ReadOnlyPassword123!'\nSETTINGS\n    max_execution_time = 300,  -- 5 分钟\n    max_memory_usage = 10000000000,  ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 10 亿行\n\n-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 在集群上创建用户\nCREATE USER IF NOT EXISTS cluster_user\nIDENTIFIED WITH sha256_password BY 'Clus",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 在所有节点上创建用户\nCREATE USER IF NOT EXISTS replicator\nIDENTIFIED WITH sha256_password BY 'ReplicatorPassword123!'\nON CLUSTER 'treasurycluster'\nDEFAULT ROLE replicator_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 查看所有用户\nSELECT name, storage, auth_type, host_ip\nFROM system.users",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看用户详细信息\nSHOW CREATE USER admin",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看用户权限\nSHOW GRANTS FOR admin",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看用户角色\nSHOW GRANTS FOR alice\nWHERE type = 'ROLE'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看用户设置\nSELECT name, value, changed\nFROM system.settings\nWHERE user = 'alice'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 修改用户密码\nALTER USER admin IDENTIFIED WITH sha256_password BY 'NewPassword123!'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 修改用户默认角色\nALTER USER alice DEFAULT ROLE readonly_role, analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 修改用户主机限制\nALTER USER bob HOST IP '10.0.0.0/8', '192.168.0.0/16'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 修改用户设置\nALTER USER readonly_user\nSETTINGS\n    max_execution_time = 600,\n    max_memory_usage = 20000000000",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 删除用户\nDROP USER IF EXISTS test_user",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 在集群上删除用户\nDROP USER IF EXISTS old_user\nON CLUSTER 'treasurycluster'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 删除用户及其所有权限\nDROP USER IF EXISTS deprecated_user\nSETTINGS drop_atomic = 0",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建只读角色\nCREATE ROLE IF NOT EXISTS readonly_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建写入角色\nCREATE ROLE IF NOT EXISTS writer_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建分析师角色\nCREATE ROLE IF NOT EXISTS analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建只读角色并分配权限\nCREATE ROLE IF NOT EXISTS readonly_role\nGRANT SELECT ON *.*",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建写入角色并分配权限\nCREATE ROLE IF NOT EXISTS writer_role\nGRANT INSERT, SELECT ON *.*",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建管理员角色并分配权限\nCREATE ROLE IF NOT EXISTS admin_role\nGRANT ALL ON *.*",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建数据库管理员角色\nCREATE ROLE IF NOT EXISTS db_admin_role\nGRANT\n    CREATE, DROP, ALTER, TRUNCATE\n    ON ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建数据分析角色（限制内存）\nCREATE ROLE IF NOT EXISTS data_analyst_role\nGRANT SELECT ON *.*\nSETTINGS\n    max_memory_usage = 5000000000,  -- 5 GB\n    max_execution_time = 300",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 5 分钟\n\n-- 创建临时用户角色（有有效期）\nCREATE ROLE IF NOT EXISTS temp_role\nGRANT SELECT ON *.*\nSETTINGS\n    max_execution_time = 60,  -- 1 分钟\n    max_rows_to_read = 1000000",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 100 万行\n\n-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 查看所有角色\nSELECT name, storage\nFROM system.roles",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看角色详细信息\nSHOW CREATE ROLE analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看角色权限\nSHOW GRANTS FOR analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看角色成员\nSELECT user_name, role_name\nFROM system.role_grants\nWHERE role_name = 'analyst_role'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 为角色添加权限\nGRANT INSERT ON analytics.* TO analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 为角色移除权限\nREVOKE INSERT ON system.* FROM analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 修改角色设置\nALTER ROLE data_analyst_role\nSETTINGS\n    max_memory_usage = 10000000000,\n    max_execution_time = 600",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 删除角色\nDROP ROLE IF EXISTS old_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 在集群上删除角色\nDROP ROLE IF EXISTS deprecated_role\nON CLUSTER 'treasurycluster'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建基础角色\nCREATE ROLE IF NOT EXISTS base_role\nGRANT SELECT ON *.*",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建只读角色（继承基础角色）\nCREATE ROLE IF NOT EXISTS readonly_role\nGRANT SELECT ON *.*\nSETTINGS INHERIT 'base_role'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建分析师角色（继承只读角色）\nCREATE ROLE IF NOT EXISTS analyst_role\nGRANT SELECT, ALTER UPDATE ON *.*\nSETTINGS INHERIT 'readonly_role'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建角色层次结构\nCREATE ROLE IF NOT EXISTS base_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON *.* TO base_role",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `base_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS readonly_role INHERIT base_role",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 41 (INHERIT): INHERIT base_role\n. Expected one of: token, At, Comma, SettingsProfileElements, SETTINGS, SETTING, PROFILES, PROFILE, ON, IN, Pa"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS writer_role INHERIT base_role",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 39 (INHERIT): INHERIT base_role\n. Expected one of: token, At, Comma, SettingsProfileElements, SETTINGS, SETTING, PROFILES, PROFILE, ON, IN, Pa"
      },
      {
        "statement": "GRANT INSERT ON *.* TO writer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS db_admin_role INHERIT readonly_role, writer_role",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 41 (INHERIT): INHERIT readonly_role, writer_role\n. Expected one of: token, At, Comma, SettingsProfileElements, SETTINGS, SETTING, PROFILES, PR"
      },
      {
        "statement": "GRANT CREATE, DROP, ALTER ON *.* TO db_admin_role",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `db_admin_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS analyst_role INHERIT readonly_role",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 40 (INHERIT): INHERIT readonly_role\n. Expected one of: token, At, Comma, SettingsProfileElements, SETTINGS, SETTING, PROFILES, PROFILE, ON, IN"
      },
      {
        "statement": "GRANT SELECT, ALTER UPDATE ON *.* TO analyst_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS admin_role INHERIT db_admin_role, analyst_role",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 38 (INHERIT): INHERIT db_admin_role, analyst_role\n. Expected one of: token, At, Comma, SettingsProfileElements, SETTINGS, SETTING, PROFILES, P"
      },
      {
        "statement": "GRANT ALL ON *.* TO admin_role",
        "success": false,
        "result": "HTTP 500: Code: 497. DB::Exception: default: Not enough privileges. To execute this query, it's necessary to have the grant ALL ON *.* WITH GRANT OPTION. (Missing permissions: SHOW NAMED COLLECTIONS SECRETS ON "
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 查看角色继承关系\nSELECT \n    r.name as role_name,\n    r2.name as inherited_role\nFROM system.role_grants rg",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看角色的所有权限（包括继承的）\nSHOW GRANTS FOR admin_role WITH INHERIT",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建有限资源的角色\nCREATE ROLE IF NOT EXISTS limited_role\nSETTINGS\n    -- 内存限制\n    max_memory_usage = 10000",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 1 GB\n\n-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建网络限制的角色\nCREATE ROLE IF NOT EXISTS network_limited_role\nSETTINGS\n    -- 网络限制\n    max_net",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 全局 20 个并发查询\n\n-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建用于备份的角色\nCREATE ROLE IF NOT EXISTS backup_role\nSETTINGS\n    max_execution_time = ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 1 GB/s\n\n-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 查看当前连接的用户\nSELECT \n    user,\n    client_hostname,\n    client_port,\n    connection_id,\n  ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看用户查询历史\nSELECT \n    user,\n    query,\n    query_duration_ms,\n    read_rows,\n    read_bytes,\n    memory_usage,\n    event_time\nFROM system.query_log\nWHERE type = 'QueryFinish'\n  AND event_time >= now",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看用户资源使用\nSELECT \n    user,\n    count() as query_count,\n    sum(read_rows) as total_read_rows,\n    sum(read_bytes) as total_read_bytes,\n    sum(memory_usage) as total_memory_usage,\n    avg(query_dur",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 查看角色分配情况\nSELECT \n    r.name as role_name,\n    count(DISTINCT rg.user_name) as user_count,\n    coun",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看角色权限分布\nSELECT \n    role_name,\n    access_type,\n    count(*) as count\nFROM system.grants\nWHERE role_name IS NOT NULL\nGROUP BY role_name, access_type\nORDER BY role_name, count DESC",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建角色\nCREATE ROLE IF NOT EXISTS readonly_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS writer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS admin_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 分配权限\nGRANT SELECT ON *.* TO readonly_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT INSERT, SELECT ON *.* TO writer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT ALL ON *.* TO admin_role",
        "success": false,
        "result": "HTTP 500: Code: 497. DB::Exception: default: Not enough privileges. To execute this query, it's necessary to have the grant ALL ON *.* WITH GRANT OPTION. (Missing permissions: SHOW NAMED COLLECTIONS SECRETS ON "
      },
      {
        "statement": "-- 创建用户\nCREATE USER IF NOT EXISTS alice\nIDENTIFIED WITH sha256_password BY 'AlicePassword123!'\nDEFAULT ROLE readonly_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS bob\nIDENTIFIED WITH sha256_password BY 'BobPassword123!'\nDEFAULT ROLE writer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE USER IF NOT EXISTS admin\nIDENTIFIED WITH sha256_password BY 'AdminPassword123!'\nDEFAULT ROLE admin_role\nSETTINGS access_management = 1",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting access_management is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (officia"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建角色\nCREATE ROLE IF NOT EXISTS sales_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS marketing_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS finance_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 创建用户并设置部门属性\nCREATE USER IF NOT EXISTS alice_sales\nIDENTIFIED WITH sha256_password BY 'AliceSales123!'\nSETTINGS department = 'sales'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS bob_marketing\nIDENTIFIED WITH sha256_password BY 'BobMarketing123!'\nSETTINGS department = 'marketing'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting department is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS charlie_finance\nIDENTIFIED WITH sha256_password BY 'CharlieFinance123!'\nSETTINGS department = 'finance'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting department is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build"
      },
      {
        "statement": "-- 创建行级安全策略\nCREATE ROW POLICY IF NOT EXISTS department_filter\nON sales.orders\nUSING department = current_user_settings['department']\nAS RESTRICTIVE TO sales_role, marketing_role, finance_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 分配角色\nGRANT SELECT ON sales.* TO sales_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON marketing.* TO marketing_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT SELECT ON finance.* TO finance_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT sales_role TO alice_sales",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `alice_sales` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT marketing_role TO bob_marketing",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `bob_marketing` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT finance_role TO charlie_finance",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `charlie_finance` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 创建临时角色（1 小时有效期）\nCREATE ROLE IF NOT EXISTS temp_role\nSETTINGS\n    max_execution_time = 3600,  -- 1 ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 5 GB\n\nGRANT SELECT ON analytics.* TO temp_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建临时用户\nCREATE USER IF NOT EXISTS temp_user\nIDENTIFIED WITH sha256_password BY 'TempPassword123!'\nDEFAULT ROLE temp_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 1 小时后删除临时用户\n-- DROP USER IF EXISTS temp_user",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本用户创建\n-- ========================================\n\n-- 在集群上创建角色\nCREATE ROLE IF NOT EXISTS cluster_reader_role\nON CLUSTER 'treasurycluster'\nGRANT SELECT O",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS cluster_writer_role\nON CLUSTER 'treasurycluster'\nGRANT INSERT, SELECT ON *.*",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 76 (GRANT) (line 3, col 1): GRANT INSERT, SELECT ON *.*\n. Expected one of: SettingsProfileElements, SETTINGS, SETTING, PROFILES, PROFILE, IN, "
      },
      {
        "statement": "-- 在集群上创建用户\nCREATE USER IF NOT EXISTS cluster_analyst\nIDENTIFIED WITH sha256_password BY 'ClusterAnalyst123!'\nDEFAULT ROLE cluster_reader_role\nON CLUSTER 'treasurycluster'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS cluster_writer\nIDENTIFIED WITH sha256_password BY 'ClusterWriter123!'\nDEFAULT ROLE cluster_writer_role\nON CLUSTER 'treasurycluster'",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `cluster_writer_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      }
    ],
    "12-security-authentication\\03_permissions_examples.sql": [
      {
        "statement": "-- ================================================\n-- 03_permissions_examples.sql\n-- 从 03_permissions.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- ================================================\n\n\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予全局 INSERT 和 SELECT 权限（读写）\nGRANT INSERT, SELECT ON *.* TO writer_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予所有权限（管理员）\nGRANT ALL ON *.* TO admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予特定 ALTER 子权限\nGRANT ALTER UPDATE, ALTER DELETE ON *.* TO updater_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予系统操作权限\nGRANT SYSTEM ON *.* TO system_admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予终止查询权限\nGRANT KILL QUERY ON *.* TO query_killer_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 授予特定数据库的 SELECT 权限\nGRANT SELECT ON analytics.* TO analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予特定数据库的所有权限\nGRANT ALL ON analytics.* TO analytics_admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予特定数据库的读写权限\nGRANT SELECT, INSERT ON sales.* TO sales_writer_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予多个数据库的权限\nGRANT SELECT ON analytics.*, sales.*, marketing.* TO multi_db_reader_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 授予特定表的 SELECT 权限\nGRANT SELECT ON analytics.events TO event_reader_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予特定表的读写权限\nGRANT SELECT, INSERT ON sales.orders TO order_writer_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予特定表的 UPDATE 和 DELETE 权限\nGRANT ALTER UPDATE, ALTER DELETE ON sales.orders TO order_updater_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予多个表的权限\nGRANT SELECT ON \n    analytics.events,\n    analytics.users,\n    analytics.orders\nTO analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 授予特定列的 SELECT 权限\nGRANT SELECT(user_id, event_type, event_time) \nON analytics.events \nTO restricted",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予 INSERT 权限到特定列\nGRANT INSERT(user_id, event_type) \nON analytics.events \nTO event_writer_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予 UPDATE 权限到特定列\nGRANT ALTER UPDATE(status, amount) \nON sales.orders \nTO order_updater_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 组合列级权限\nGRANT \n    SELECT(user_id, username) \n    ON analytics.users,\n    SELECT(event_id, event_type) \n    ON analytics.events\nTO restricted_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 授予字典权限\nGRANT SELECT ON DICTIONARY user_dict TO dictionary_user_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予函数权限\nGRANT SELECT ON FUNCTION my_udf TO function_user_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予多个字典权限\nGRANT SELECT ON DICTIONARY\n    user_dict,\n    product_dict,\n    category_dict\nTO dictionary_analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 撤销全局权限\nREVOKE INSERT ON *.* FROM writer_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 撤销数据库权限\nREVOKE ALTER ON analytics.* FROM analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 撤销表权限\nREVOKE SELECT ON analytics.events FROM event_reader_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 撤销列权限\nREVOKE SELECT(password, token) ON analytics.users FROM analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 撤销 ALTER 子权限\nREVOKE ALTER UPDATE, ALTER DELETE ON sales.* FROM updater_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 撤销角色所有权限\nREVOKE ALL PRIVILEGES, GRANT OPTION FROM admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 撤销用户所有权限\nREVOKE ALL PRIVILEGES, GRANT OPTION FROM alice",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 撤销特定作用域的所有权限\nREVOKE ALL PRIVILEGES ON analytics.* FROM analytics_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 创建只读敏感列的角色\nCREATE ROLE IF NOT EXISTS sensitive_data_reader",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予非敏感列的 SELECT 权限\nGRANT \n    SELECT(user_id, username, email) \nON analytics.users \nTO sensitive_data_reader",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 拒绝敏感列的访问\nREVOKE SELECT(password, token, credit_card) \nON analytics.users \nFROM sensitive_data_reader",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建敏感数据管理员角色\nCREATE ROLE IF NOT EXISTS sensitive_data_admin",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予所有列的权限\nGRANT ALL ON analytics.users TO sensitive_data_admin",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 场景：保护用户隐私数据\nCREATE ROLE IF NOT EXISTS privacy_protected_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 用户可以查看基本信息\nGRANT \n    SELECT(user_id, username, email, created_at) \nON analytics.users \nTO privacy_protected_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 用户不能查看敏感信息\nREVOKE \n    SELECT(password, token, phone, address) \nON analytics.users \nFROM privacy_protected_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建隐私管理员角色\nCREATE ROLE IF NOT EXISTS privacy_admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 隐私管理员可以查看所有信息\nGRANT SELECT ON analytics.users TO privacy_admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 分配用户\nCREATE USER IF NOT EXISTS alice\nIDENTIFIED WITH sha256_password BY 'Alice123!'\nDEFAULT ROLE privacy_protected_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS admin\nIDENTIFIED WITH sha256_password BY 'Admin123!'\nDEFAULT ROLE privacy_admin_role",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `privacy_admin_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 创建外部字典\nCREATE DICTIONARY IF NOT EXISTS user_dict\n(\n    user_id UInt64,\n    user_name String,\n    d",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予字典权限\nCREATE ROLE IF NOT EXISTS dictionary_reader",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON DICTIONARY user_dict TO dictionary_reader",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 28 (user_dict): user_dict TO dictionary_reader\n. Expected one of: token, Asterisk, Dot, Comma, ON, TO. (SYNTAX_ERROR) (version 25.12.3.21 (off"
      },
      {
        "statement": "-- 使用字典\nSELECT \n    e.event_id,\n    e.event_type,\n    dictGet('user_dict', 'user_name', e.user_id) as user_name,\n    dictGet('user_dict', 'department', e.user_id) as department\nFROM analytics.events e",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 创建用户定义函数\nCREATE FUNCTION IF NOT EXISTS calculate_discount\nAS (amount -> amount * 0.9)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 授予函数权限\nCREATE ROLE IF NOT EXISTS discount_user",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON FUNCTION calculate_discount TO discount_user",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 26 (calculate_discount): calculate_discount TO discount_user\n. Expected one of: token, Asterisk, Dot, Comma, ON, TO. (SYNTAX_ERROR) (version 2"
      },
      {
        "statement": "-- 使用 UDF\nSELECT \n    order_id,\n    amount,\n    calculate_discount(amount) as discounted_amount\nFROM sales.orders",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 查看角色权限\nSHOW GRANTS FOR readonly_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看用户权限\nSHOW GRANTS FOR alice",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看所有角色的权限\nSELECT \n    role_name,\n    access_type,\n    database,\n    table,\n    column,\n    is_partial_revoke\nFROM system.grants\nWHERE role_name IS NOT NULL\nORDER BY role_name, access_type",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看特定数据库的权限\nSELECT \n    role_name,\n    access_type,\n    table,\n    column\nFROM system.grants\nWHERE database = 'analytics'\nORDER BY role_name, table, column",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 查看用户查询历史和权限使用\nSELECT \n    user,\n    query,\n    query_duration_ms,\n    read_rows,\n    read_bytes,\n ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看权限拒绝的查询\nSELECT \n    user,\n    query,\n    exception_text,\n    event_time\nFROM system.query_log\nWHERE type = 'Exception'\n  AND exception_code = 516  -- ACCESS_DENIED\n  AND event_time >= now() - INT",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 创建角色\nCREATE ROLE IF NOT EXISTS readonly_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS writer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS analyzer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS admin_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 分配权限\n-- 只读角色\nGRANT SELECT ON *.* TO readonly_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 写入角色\nGRANT SELECT, INSERT ON *.* TO writer_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 分析师角色\nGRANT SELECT ON *.* TO analyzer_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT ALTER UPDATE, ALTER DELETE ON analytics.* TO analyzer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 管理员角色\nGRANT ALL ON *.* TO admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建用户\nCREATE USER IF NOT EXISTS alice\nIDENTIFIED WITH sha256_password BY 'Alice123!'\nDEFAULT ROLE readonly_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS bob\nIDENTIFIED WITH sha256_password BY 'Bob123!'\nDEFAULT ROLE writer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE USER IF NOT EXISTS charlie\nIDENTIFIED WITH sha256_password BY 'Charlie123!'\nDEFAULT ROLE analyzer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE USER IF NOT EXISTS admin\nIDENTIFIED WITH sha256_password BY 'Admin123!'\nDEFAULT ROLE admin_role\nSETTINGS access_management = 1",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting access_management is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (officia"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 创建角色\nCREATE ROLE IF NOT EXISTS public_analyst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS internal_analyst",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS security_admin",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 公开分析师：只能查看非敏感数据\nGRANT \n    SELECT(\n        user_id, \n        username, \n        created_at, \n        last_login\n    ) \nON analytics.users \nTO public_analyst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 内部分析师：可以查看更多数据\nGRANT \n    SELECT(\n        user_id, \n        username, \n        email, \n        phone, \n        created_at, \n        last_login,\n        account_status\n    ) \nON analytics.users \nTO ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 安全管理员：可以查看所有数据\nGRANT ALL ON analytics.users TO security_admin",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建用户\nCREATE USER IF NOT EXISTS public_analyst\nIDENTIFIED WITH sha256_password BY 'PublicAnalyst123!'\nDEFAULT ROLE public_analyst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS internal_analyst\nIDENTIFIED WITH sha256_password BY 'InternalAnalyst123!'\nDEFAULT ROLE internal_analyst",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE USER IF NOT EXISTS security_admin\nIDENTIFIED WITH sha256_password BY 'SecurityAdmin123!'\nDEFAULT ROLE security_admin",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 创建角色\nCREATE ROLE IF NOT EXISTS sales_reader",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS marketing_reader",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS finance_reader",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 销售部门：只能访问销售数据\nGRANT SELECT ON sales.* TO sales_reader",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 营销部门：只能访问营销数据\nGRANT SELECT ON marketing.* TO marketing_reader",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 财务部门：只能访问财务数据\nGRANT SELECT ON finance.* TO finance_reader",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建用户\nCREATE USER IF NOT EXISTS alice_sales\nIDENTIFIED WITH sha256_password BY 'AliceSales123!'\nSETTINGS department = 'sales'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS bob_marketing\nIDENTIFIED WITH sha256_password BY 'BobMarketing123!'\nSETTINGS department = 'marketing'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting department is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS charlie_finance\nIDENTIFIED WITH sha256_password BY 'CharlieFinance123!'\nSETTINGS department = 'finance'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting department is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build"
      },
      {
        "statement": "-- 分配角色\nGRANT sales_reader TO alice_sales",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT marketing_reader TO bob_marketing",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `bob_marketing` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT finance_reader TO charlie_finance",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `charlie_finance` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- 创建行级安全策略\nCREATE ROW POLICY IF NOT EXISTS department_filter\nON sales.orders\nUSING department = current_user_settings['department']\nAS RESTRICTIVE TO sales_reader, marketing_reader, finance_reader",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 创建临时角色（24 小时有效期）\nCREATE ROLE IF NOT EXISTS temp_access_role\nSETTINGS\n    max_execution_time = 8640",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 5 GB\n\nGRANT SELECT ON analytics.* TO temp_access_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建临时用户\nCREATE USER IF NOT EXISTS temp_user\nIDENTIFIED WITH sha256_password BY 'TempUser123!'\nDEFAULT ROLE temp_access_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 24 小时后删除临时用户\n-- DROP USER IF EXISTS temp_user",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 授予全局权限\n-- ========================================\n\n-- 创建只读视图\nCREATE VIEW analytics.user_summary AS\nSELECT \n    user_id,\n    username,\n    email,\n    cre",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建只读角色\nCREATE ROLE IF NOT EXISTS view_only_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON analytics.user_summary TO view_only_role",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `view_only_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- 拒绝对底层表的访问\nREVOKE SELECT ON analytics.users FROM view_only_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建用户\nCREATE USER IF NOT EXISTS readonly_user\nIDENTIFIED WITH sha256_password BY 'ReadOnly123!'\nDEFAULT ROLE view_only_role",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "12-security-authentication\\04_row_level_security_examples.sql": [
      {
        "statement": "-- ================================================\n-- 04_row_level_security_examples.sql\n-- 从 04_row_level_security.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- =====================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建许可性行策略\nCREATE ROW POLICY IF NOT EXISTS recent_data_filter\nON analytics.events\nUSING event_time >= now() - INTERVAL 30 DAY\nAS PERMISSIVE TO analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建混合行策略\nCREATE ROW POLICY IF NOT EXISTS department_filter\nON sales.orders\nUSING department = current_user_settings['department']\nAS RESTRICTIVE TO analyst_role, manager_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\nCREATE [OR REPLACE] ROW POLICY [IF NOT EXISTS] name\nON [database.]table [AS PERMISSIVE | RESTRICTIVE",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询：只会返回满足所有条件的行\nSELECT * FROM analytics.user_data",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 等价于：\n-- SELECT * FROM analytics.user_data \n-- WHERE user_id = current_user() AND status = 'active'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建许可性策略\nCREATE ROW POLICY IF NOT EXISTS flexible_data_filter\nON analytics.events\nUSING \n    user_",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询：返回满足任意一个条件的行\nSELECT * FROM analytics.events",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 限制性策略 1\nCREATE ROW POLICY IF NOT EXISTS user_filter\nON analytics.user_events\nUSING user_id = curr",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 限制性策略 2\nCREATE ROW POLICY IF NOT EXISTS status_filter\nON analytics.user_events\nUSING status IN ('active', 'pending')\nAS RESTRICTIVE TO analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 许可性策略\nCREATE ROW POLICY IF NOT EXISTS admin_bypass\nON analytics.user_events\nUSING current_user() = 'admin'\nAS PERMISSIVE TO admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建表\nCREATE TABLE IF NOT EXISTS analytics.user_events\nON CLUSTER 'treasurycluster'\n(\n    event_id ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建行策略\nCREATE ROW POLICY IF NOT EXISTS user_data_filter\nON analytics.user_events\nUSING user_id = current_user()\nAS RESTRICTIVE TO readonly_user",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建用户\nCREATE USER IF NOT EXISTS alice\nIDENTIFIED WITH sha256_password BY 'Alice123!'\nSETTINGS access_management = 0",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS bob\nIDENTIFIED WITH sha256_password BY 'Bob123!'\nSETTINGS access_management = 0",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting access_management is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (officia"
      },
      {
        "statement": "-- 测试：alice 只能看到自己的数据\n-- SELECT * FROM analytics.user_events",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 只返回 user_id = 'alice' 的行\n-- Bob 执行同样查询，只能看到 user_id = 'bob' 的行\n\n-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建带部门设置的用户\nCREATE USER IF NOT ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS bob_marketing\nIDENTIFIED WITH sha256_password BY 'BobMarketing123!'\nSETTINGS department = 'marketing'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting department is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build"
      },
      {
        "statement": "-- 创建表\nCREATE TABLE IF NOT EXISTS sales.orders\nON CLUSTER 'treasurycluster'\n(\n    order_id UInt64,\n    user_id String,\n    product_id String,\n    amount Decimal(18, 2),\n    department String,\n    stat",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建行策略\nCREATE ROW POLICY IF NOT EXISTS department_filter\nON sales.orders\nUSING department = current_user_settings['department']\nAS RESTRICTIVE TO alice_sales, bob_marketing",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 测试：alice_sales 只能看到 sales 部门的订单\n-- SELECT * FROM sales.orders",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 只返回 department = 'sales' 的行\n-- Bob 执行同样查询，只能看到 department = 'marketing' 的行\n\n-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建角色\nCREATE ROLE I",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS marketing_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 创建行策略\nCREATE ROW POLICY IF NOT EXISTS sales_data_filter\nON sales.orders\nUSING department = 'sales'\nAS RESTRICTIVE TO sales_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROW POLICY IF NOT EXISTS marketing_data_filter\nON sales.orders\nUSING department = 'marketing'\nAS RESTRICTIVE TO marketing_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 创建用户并分配角色\nCREATE USER IF NOT EXISTS alice\nIDENTIFIED WITH sha256_password BY 'Alice123!'\nDEFAULT ROLE sales_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS bob\nIDENTIFIED WITH sha256_password BY 'Bob123!'\nDEFAULT ROLE marketing_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建行策略：只允许访问最近 30 天的数据\nCREATE ROW POLICY IF NOT EXISTS recent_data_filter\nON analytics.events\nUSIN",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建行策略：允许管理员访问所有数据\nCREATE ROW POLICY IF NOT EXISTS admin_bypass_filter\nON analytics.events\nUSING 1=1\nAS PERMISSIVE TO admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建行策略：只允许访问历史数据（30 天前）\nCREATE ROW POLICY IF NOT EXISTS historical_data_filter\nON analytics.events",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建行策略：允许访问当前日期之前的数据\nCREATE ROW POLICY IF NOT EXISTS past_data_filter\nON analytics.events\nUSING event_time < today()\nAS RESTRICTIVE TO readonly_user",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建行策略：只允许访问当前季度\nCREATE ROW POLICY IF NOT EXISTS current_quarter_filter\nON sales.orders\nUSING \n   ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建行策略：只允许访问当前月\nCREATE ROW POLICY IF NOT EXISTS current_month_filter\nON sales.orders\nUSING \n    toYearMonth(order_date) = toYearMonth(now())\nAS RESTRICTIVE TO current_month_analyst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建用户到部门的映射字典\nCREATE DICTIONARY IF NOT EXISTS user_department_map\n(\n    user_id String,\n    depart",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建行策略\nCREATE ROW POLICY IF NOT EXISTS dynamic_department_filter\nON sales.orders\nUSING \n    department = dictGet('user_department_map', 'department', current_user())\n    AND dictGet('user_department",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建行策略：基于用户设置的日期范围\nCREATE ROW POLICY IF NOT EXISTS dynamic_date_filter\nON analytics.events\nUSING \n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 为用户设置日期范围\nCREATE USER IF NOT EXISTS analyst\nIDENTIFIED WITH sha256_password BY 'Analyst123!'\nSETTINGS \n    min_date = '2024-01-01',\n    max_date = '2024-12-31'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建行策略：基于标签过滤\nCREATE ROW POLICY IF NOT EXISTS tag_filter\nON analytics.documents\nUSING \n    has(spl",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 为用户设置标签\nCREATE USER IF NOT EXISTS alice\nIDENTIFIED WITH sha256_password BY 'Alice123!'\nSETTINGS tag = 'finance'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS bob\nIDENTIFIED WITH sha256_password BY 'Bob123!'\nSETTINGS tag = 'marketing'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting tag is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 查看所有行策略\nSELECT \n    name,\n    database,\n    table,\n    filter_expression,\n    is_permissive,\n    ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看特定表的行策略\nSELECT \n    name,\n    filter_expression,\n    is_permissive\nFROM system.row_policies\nWHERE database = 'analytics'\n  AND table = 'user_events'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看应用于特定角色的行策略\nSELECT \n    rp.name,\n    rp.database,\n    rp.table,\n    rp.filter_expression,\n    rp.is_permissive\nFROM system.row_policies rp\nJOIN system.grants g ON rp.name = g.access_type\nWHERE g.",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 测试行策略效果\nSELECT \n    user_id,\n    count() as event_count\nFROM analytics.user_events\nGROUP BY user_",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 使用不同用户测试\nSET user = 'alice'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "SELECT count() FROM analytics.user_events",
        "success": false,
        "result": "HTTP 404: Code: 81. DB::Exception: Database analytics does not exist. (UNKNOWN_DATABASE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "SET user = 'bob'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting user is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "SELECT count() FROM analytics.user_events",
        "success": false,
        "result": "HTTP 404: Code: 81. DB::Exception: Database analytics does not exist. (UNKNOWN_DATABASE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- 查看查询执行计划（包含行策略）\nEXPLAIN SELECT * FROM analytics.user_events",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建表\nCREATE TABLE IF NOT EXISTS multi_tenant.orders\nON CLUSTER 'treasurycluster'\n(\n    order_id UI",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建租户用户\nCREATE USER IF NOT EXISTS tenant1\nIDENTIFIED WITH sha256_password BY 'Tenant1Password123!'\nSETTINGS tenant_id = 'tenant1'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS tenant2\nIDENTIFIED WITH sha256_password BY 'Tenant2Password123!'\nSETTINGS tenant_id = 'tenant2'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting tenant_id is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build)"
      },
      {
        "statement": "-- 创建行策略\nCREATE ROW POLICY IF NOT EXISTS tenant_filter\nON multi_tenant.orders\nUSING tenant_id = current_user_settings['tenant_id']\nAS RESTRICTIVE TO tenant1, tenant2",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 测试：每个租户只能看到自己的订单\n-- tenant1: SELECT * FROM multi_tenant.orders",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 只返回 tenant_id = 'tenant1'\n-- tenant2: SELECT * FROM multi_tenant.orders",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 只返回 tenant_id = 'tenant2'\n\n-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建表\nCREATE TABLE IF NOT EXISTS analytics.user_profiles\nON CLUSTER '",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建角色\nCREATE ROLE IF NOT EXISTS low_access_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS medium_access_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS high_access_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 创建行策略\n-- 低权限用户：只能查看 low sensitivity 数据\nCREATE ROW POLICY IF NOT EXISTS low_access_filter\nON analytics.user_profiles\nUSING sensitivity_level = 'low'\nAS RESTRICTIVE TO low_access_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 中权限用户：可以查看 low 和 medium sensitivity 数据\nCREATE ROW POLICY IF NOT EXISTS medium_access_filter\nON analytics.user_profiles\nUSING sensitivity_level IN ('low', 'medium')\nAS RESTRICTIVE TO medium_access_r",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 高权限用户：可以查看所有数据\nCREATE ROW POLICY IF NOT EXISTS high_access_filter\nON analytics.user_profiles\nUSING sensitivity_level IN ('low', 'medium', 'high')\nAS RESTRICTIVE TO high_access_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建表\nCREATE TABLE IF NOT EXISTS geo.sales\nON CLUSTER 'treasurycluster'\n(\n    sale_id UInt64,\n    r",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建区域用户\nCREATE USER IF NOT EXISTS north_america_user\nIDENTIFIED WITH sha256_password BY 'NorthAmerica123!'\nSETTINGS region = 'North America'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS europe_user\nIDENTIFIED WITH sha256_password BY 'Europe123!'\nSETTINGS region = 'Europe'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting region is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS asia_user\nIDENTIFIED WITH sha256_password BY 'Asia123!'\nSETTINGS region = 'Asia'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting region is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- 创建行策略\nCREATE ROW POLICY IF NOT EXISTS region_filter\nON geo.sales\nUSING region = current_user_settings['region']\nAS RESTRICTIVE TO north_america_user, europe_user, asia_user",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 测试：每个区域用户只能看到自己的销售数据\n\n-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建表\nCREATE TABLE IF NOT EXISTS analytics.time_series\nON CLUSTER 'treasur",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建角色\nCREATE ROLE IF NOT EXISTS realtime_analyst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS daily_analyst",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS monthly_analyst",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 创建行策略\n-- 实时分析师：只访问最近 1 小时\nCREATE ROW POLICY IF NOT EXISTS realtime_filter\nON analytics.time_series\nUSING timestamp >= now() - INTERVAL 1 HOUR\nAS RESTRICTIVE TO realtime_analyst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 日分析师：只访问最近 7 天\nCREATE ROW POLICY IF NOT EXISTS daily_filter\nON analytics.time_series\nUSING timestamp >= now() - INTERVAL 7 DAY\nAS RESTRICTIVE TO daily_analyst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 月分析师：只访问最近 30 天\nCREATE ROW POLICY IF NOT EXISTS monthly_filter\nON analytics.time_series\nUSING timestamp >= now() - INTERVAL 30 DAY\nAS RESTRICTIVE TO monthly_analyst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本行策略创建\n-- ========================================\n\n-- 创建表\nCREATE TABLE IF NOT EXISTS secure.transactions\nON CLUSTER 'treasurycluster'\n(\n    transaction",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建用户\nCREATE USER IF NOT EXISTS alice\nIDENTIFIED WITH sha256_password BY 'Alice123!'\nSETTINGS \n    department = 'sales',\n    sensitivity_level = 'medium'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建行策略\n-- 策略 1：部门过滤\nCREATE ROW POLICY IF NOT EXISTS department_filter\nON secure.transactions\nUSING department = current_user_settings['department']\nAS RESTRICTIVE TO alice",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 策略 2：敏感级别过滤\nCREATE ROW POLICY IF NOT EXISTS sensitivity_filter\nON secure.transactions\nUSING sensitivity_level <= current_user_settings['sensitivity_level']\nAS RESTRICTIVE TO alice",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 策略 3：时间窗口过滤\nCREATE ROW POLICY IF NOT EXISTS time_filter\nON secure.transactions\nUSING transaction_date >= now() - INTERVAL 90 DAY\nAS RESTRICTIVE TO alice",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "12-security-authentication\\05_network_security_examples.sql": [
      {
        "statement": "-- ================================================\n-- 05_network_security_examples.sql\n-- 从 05_network_security.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- =========================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS bob\nIDENTIFIED WITH sha256_password BY 'BobPassword123!'\nHOST IP '192.168.2.0/24'\nHOST NAME 'analyst-*.company.com'\nHOST REGEXP 'worker-\\\\d+\\\\.company\\\\.com'",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- ========================================\n-- 使用 SQL 创建用户并限制 IP\n-- ========================================\n\n-- 查看当前连接\nSELECT \n    user,\n    client_hostname,\n    client_port,\n    server_port_name,\n  ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看连接历史\nSELECT \n    user,\n    client_hostname,\n    event_time,\n    query_duration_ms,\n    read_rows,\n    read_bytes,\n    memory_usage\nFROM system.query_log\nWHERE type = 'QueryFinish'\n  AND event_tim",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看异常连接\nSELECT \n    user,\n    client_hostname,\n    exception_text,\n    event_time\nFROM system.query_log\nWHERE type = 'Exception'\n  AND (exception_code = 516  -- ACCESS_DENIED\n       OR exception_cod",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 使用 SQL 创建用户并限制 IP\n-- ========================================\n\n-- 查看网络使用情况\nSELECT \n    user,\n    count() as query_count,\n    sum(read_bytes) / 1024 / 102",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看客户端网络使用\nSELECT \n    client_hostname,\n    count() as query_count,\n    sum(read_bytes) / 1024 / 1024 / 1024 as read_gb,\n    sum(write_bytes) / 1024 / 1024 / 1024 as write_gb\nFROM system.query_log\nW",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "12-security-authentication\\06_data_encryption_examples.sql": [
      {
        "statement": "-- ================================================\n-- 06_data_encryption_examples.sql\n-- 从 06_data_encryption.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- ===========================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 插入加密数据\nINSERT INTO secure.encrypted_users\nVALUES\n(1, 'alice', encrypt('alice@example.com', 'MySecretKey123!', 'AES'), '...', now()),\n(2, 'bob', encrypt('bob@example.com', 'MySecretKey123!', 'AES'),",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询时解密\nSELECT \n    user_id,\n    username,\n    decrypt(encrypted_email, 'MySecretKey123!', 'AES') as email,\n    decrypt(encrypted_phone, 'MySecretKey123!', 'AES') as phone\nFROM secure.encrypted_users",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 使用 AES 加密函数\n-- ========================================\n\n-- 创建自定义加密函数（需要 ClickHouse 支持 UDF）\n-- 注意：ClickHouse 社区版不支持 UDF，企业版支持\n\n-- 替代方案：使用应用层加密\n-- 1. 应用层使",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 插入加密数据（应用层加密后）\nINSERT INTO secure.encrypted_events\nVALUES\n(1, 'alice', '{\"email\":\"encrypted_email\",\"phone\":\"encrypted_phone\"}', now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询数据（应用层解密）\nSELECT \n    event_id,\n    user_id,\n    encrypted_data  -- 应用层解密\nFROM secure.encrypted_events",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 使用 AES 加密函数\n-- ========================================\n\n-- 1. 只加密必要列\nCREATE TABLE IF NOT EXISTS secure.optimized_users\nON CLUSTER 'treasurycluster'\n(\n  ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. 使用物化视图加速查询\nCREATE MATERIALIZED VIEW IF NOT EXISTS secure.users_email_view\nENGINE = ReplicatedAggregatingMergeTree()\nAS SELECT\n    user_id,\n    decrypt(encrypted_email, 'MySecretKey123!', 'AES') ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 3. 使用缓存\nSET use_query_cache = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "SELECT \n    user_id,\n    decrypt(encrypted_email, 'MySecretKey123!', 'AES') as email\nFROM secure.encrypted_users\nWHERE user_id = 1",
        "success": false,
        "result": "HTTP 404: Code: 81. DB::Exception: Database secure does not exist. (UNKNOWN_DATABASE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- ========================================\n-- 使用 AES 加密函数\n-- ========================================\n\n-- 第 1 层：公开数据（无加密）\nCREATE TABLE IF NOT EXISTS secure.public_data\nON CLUSTER 'treasurycluster'\n(\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 第 2 层：内部数据（传输加密）\nCREATE TABLE IF NOT EXISTS secure.internal_data\nON CLUSTER 'treasurycluster'\n(\n    event_id UInt64,\n    user_id String,\n    event_data String,\n    event_time DateTime\n)\nENGINE = Re",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 第 3 层：敏感数据（列级加密）\nCREATE TABLE IF NOT EXISTS secure.sensitive_data\nON CLUSTER 'treasurycluster'\n(\n    event_id UInt64,\n    user_id String,\n    encrypted_data String,  -- 应用层加密\n    event_time DateTim",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 第 4 层：绝密数据（磁盘加密 + 列级加密）\n-- 表存储在加密的磁盘上\nCREATE TABLE IF NOT EXISTS secure.top_secret_data\nON CLUSTER 'treasurycluster'\n(\n    event_id UInt64,\n    user_id String,\n    encrypted_data String,  -- 应用层加密\n",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "12-security-authentication\\07_audit_log_examples.sql": [
      {
        "statement": "-- ================================================\n-- 07_audit_log_examples.sql\n-- 从 07_audit_log.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- ================================================\n\n\n-- =",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看特定用户的查询\nSELECT \n    event_time,\n    query,\n    query_duration_ms,\n    read_rows,\n    read_bytes,\n    memory_usage\nFROM system.query_log\nWHERE user = 'alice'\n  AND type = 'QueryFinish'\n  AND event",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看失败的查询\nSELECT \n    event_time,\n    user,\n    query,\n    exception_code,\n    exception_text\nFROM system.query_log\nWHERE type = 'Exception'\n  AND event_time >= now() - INTERVAL 7 DAY\nORDER BY event_",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 查看所有查询\n-- ========================================\n\n-- 查看最慢的 100 条查询\nSELECT \n    event_time,\n    user,\n    query,\n    query_duration_ms / 1000 as duratio",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 按用户统计慢查询\nSELECT \n    user,\n    count() as slow_query_count,\n    avg(query_duration_ms) as avg_duration_ms,\n    max(query_duration_ms) as max_duration_ms,\n    sum(read_rows) as total_read_rows,\n    ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 查看所有查询\n-- ========================================\n\n-- 查看 Mutation 操作\nSELECT \n    event_time,\n    mutation_id,\n    database,\n    table,\n    command,\n    ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看 Mutation 进度\nSELECT \n    database,\n    table,\n    mutation_id,\n    command,\n    sum(parts_to_do - 1) as remaining_parts,\n    count() as total_mutations\nFROM system.mutation_log\nWHERE is_done = 0\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看 Mutation 历史\nSELECT \n    event_date,\n    database,\n    table,\n    count() as mutation_count,\n    sum(if(is_done = 1, 1, 0)) as completed_count,\n    avg(dateDiff('second', event_time, now())) as a",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 查看所有查询\n-- ========================================\n\n-- 用户查询统计\nSELECT \n    user,\n    count() as total_queries,\n    countIf(type = 'QueryFinish') as succes",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 用户访问模式\nSELECT \n    user,\n    countIf(contains(query, 'SELECT')) as select_count,\n    countIf(contains(query, 'INSERT')) as insert_count,\n    countIf(contains(query, 'ALTER')) as alter_count,\n    co",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 客户端 IP 统计\nSELECT \n    IPv6NumToString(address) as client_ip,\n    count() as query_count,\n    count(DISTINCT user) as unique_users,\n    avg(query_duration_ms) as avg_duration_ms\nFROM system.query_lo",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 查看所有查询\n-- ========================================\n\n-- 查看失败的登录尝试\nSELECT \n    event_time,\n    exception_text\nFROM system.query_log\nWHERE exception_code = ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看权限拒绝\nSELECT \n    user,\n    query,\n    exception_text,\n    count() as failure_count\nFROM system.query_log\nWHERE exception_code = 516\n  AND event_time >= now() - INTERVAL 7 DAY\nGROUP BY user, query",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看异常查询\nSELECT \n    event_time,\n    user,\n    query,\n    exception_code,\n    exception_text\nFROM system.query_log\nWHERE type = 'Exception'\n  AND event_time >= now() - INTERVAL 1 DAY\nORDER BY event_t",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 查看所有查询\n-- ========================================\n\n-- 查询性能统计\nSELECT \n    event_date,\n    count() as total_queries,\n    avg(query_duration_ms) as avg_dur",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 内存使用统计\nSELECT \n    user,\n    avg(memory_usage) / 1024 / 1024 / 1024 as avg_memory_gb,\n    max(memory_usage) / 1024 / 1024 / 1024 as max_memory_gb,\n    sum(memory_usage) / 1024 / 1024 / 1024 as tota",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 查看所有查询\n-- ========================================\n\n-- 1. 创建告警表\nCREATE TABLE IF NOT EXISTS security.alerts\nON CLUSTER 'treasurycluster'\n(\n    alert_id UU",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. 创建慢查询告警视图\nCREATE MATERIALIZED VIEW IF NOT EXISTS security.slow_query_alerts_mv\nTO security.alerts\nAS SELECT\n    generateUUIDv4() as alert_id,\n    'slow_query' as alert_type,\n    if(query_duratio",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 查看所有查询\n-- ========================================\n\n-- 查看所有告警\nSELECT \n    alert_id,\n    alert_type,\n    alert_level,\n    message,\n    alert_time,\n    res",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查看未解决的告警\nSELECT \n    alert_id,\n    alert_type,\n    alert_level,\n    message,\n    alert_time\nFROM security.alerts\nWHERE resolved = 0\nORDER BY alert_level DESC, alert_time DESC",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 统计告警\nSELECT \n    alert_type,\n    alert_level,\n    count() as alert_count\nFROM security.alerts\nWHERE alert_time >= now() - INTERVAL 1 DAY\nGROUP BY alert_type, alert_level\nORDER BY alert_level DESC, ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 查看所有查询\n-- ========================================\n\n-- 1. 用户活动报告\nSELECT \n    'User Activity Report' as report_type,\n    now() as report_time,\n    '' as l",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. 安全事件报告\nSELECT \n    'Security Events Report' as report_type,\n    now() as report_time,\n    '' as line\nUNION ALL\nSELECT \n    format('Failed queries: {}', count()) as report_type,\n    '' as report_",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "12-security-authentication\\08_best_practices_examples.sql": [
      {
        "statement": "-- ================================================\n-- 08_best_practices_examples.sql\n-- 从 08_best_practices.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- =============================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 定期更换密码（每 90 天）\nALTER USER admin IDENTIFIED WITH sha256_password BY 'NewAdmin@Password123!'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- ✅ 推荐：使用 SHA-256 密码\nCREATE USER IF NOT EXISTS user1\nIDENTIFIED WITH sha256_password BY 'SecurePas",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ❌ 避免：使用明文密码（仅用于测试）\nCREATE USER IF NOT EXISTS test_user\nIDENTIFIED WITH plaintext_password BY 'TestPassword123!'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 集成 LDAP 进行身份认证\nCREATE USER IF NOT EXISTS ldap_user\nIDENTIFIED WITH ldap_server 'company_ldap'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS ldap_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT SELECT ON *.* TO ldap_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT ldap_role TO ldap_user",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `ldap_user` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 创建用户并限制 IP 访问\nCREATE USER IF NOT EXISTS internal_user\nIDENTIFIED WITH sha256_password BY 'Intern",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- ❌ 删除或修改默认的 default 用户\nDROP USER IF EXISTS default",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 或修改默认用户密码\nALTER USER default IDENTIFIED WITH sha256_password BY 'NewSecurePassword123!'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- ✅ 推荐：使用角色管理权限\nCREATE ROLE IF NOT EXISTS readonly_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON *.* TO readonly_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE USER IF NOT EXISTS alice\nIDENTIFIED WITH sha256_password BY 'AlicePassword123!'\nDEFAULT ROLE readonly_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- ❌ 避免：直接为用户分配权限\nCREATE USER IF NOT EXISTS bob\nIDENTIFIED WITH sha256_password BY 'BobPassword123!'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON *.* TO bob",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 只授予必要的最小权限\nCREATE ROLE IF NOT EXISTS data_analyst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON analytics.* TO data_analyst",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `data_analyst` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT SELECT ON sales.* TO data_analyst",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `data_analyst` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- 不授予 INSERT、UPDATE、DELETE 等权限\n\n-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 创建行级安全策略\nCREATE ROW POLICY IF NOT EXISTS user_data_filter\nON an",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 只授予非敏感列的访问权限\nGRANT \n    SELECT(user_id, username, email) \nON analytics.users \nTO public_analyst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 撤销敏感列的访问权限\nREVOKE \n    SELECT(password, token, ssn) \nON analytics.users \nFROM public_analyst",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 定期审查用户权限\nSELECT \n    user,\n    count() as permission_count,\n    groupUniqArray(distinct table) a",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 使用应用层加密\nCREATE TABLE IF NOT EXISTS secure.encrypted_users\n(\n    user_id UInt64,\n    username Str",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 查看异常访问\nSELECT \n    user,\n    count() as failed_attempts\nFROM system.query_log\nWHERE exception_co",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 慢查询告警\nCREATE MATERIALIZED VIEW security.slow_query_alerts_mv\nTO security.alerts\nAS SELECT\n    ge",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 每周安全报告\nSELECT \n    'Security Report' as report_type,\n    format('Week: {} to {}', \n           to",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 创建租户表\nCREATE TABLE IF NOT EXISTS multi_tenant.orders\n(\n    order_id UInt64,\n    tenant_id String",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建租户用户\nCREATE USER IF NOT EXISTS tenant1\nIDENTIFIED WITH sha256_password BY 'Tenant1Password123!'\nSETTINGS tenant_id = 'tenant1'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建行级安全策略\nCREATE ROW POLICY IF NOT EXISTS tenant_filter\nON multi_tenant.orders\nUSING tenant_id = current_user_settings['tenant_id']\nAS RESTRICTIVE TO tenant1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 1. 使用强密码\n-- ========================================\n\n-- 配置审计日志\n<query_log>\n    <database>system</database>\n    <table>query_log</table>\n    <partition_b",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "12-security-authentication\\09_common_configs_examples.sql": [
      {
        "statement": "-- ================================================\n-- 09_common_configs_examples.sql\n-- 从 09_common_configs.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- =============================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 创建只读用户\nCREATE ROLE IF NOT EXISTS readonly_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON *.* TO readonly_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE USER IF NOT EXISTS readonly_user\nIDENTIFIED WITH sha256_password BY 'ReadOnly@Password123!'\nDEFAULT ROLE readonly_role\nHOST IP '192.168.0.0/16'",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- ========================================\n-- SQL Block 2\n-- ========================================\n\n-- 1. 创建角色\nCREATE ROLE IF NOT EXISTS admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS readonly_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS writer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS analyst_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 2. 分配权限\nGRANT ALL ON *.* TO admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON *.* TO readonly_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT SELECT, INSERT ON *.* TO writer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT SELECT, ALTER UPDATE, ALTER DELETE ON *.* TO analyst_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 3. 创建用户\nCREATE USER IF NOT EXISTS admin\nIDENTIFIED WITH sha256_password BY 'Admin@SecurePassword123!'\nDEFAULT ROLE admin_role\nSETTINGS access_management = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS readonly_user\nIDENTIFIED WITH sha256_password BY 'ReadOnly@Password123!'\nDEFAULT ROLE readonly_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE USER IF NOT EXISTS writer_user\nIDENTIFIED WITH sha256_password BY 'Writer@Password123!'\nDEFAULT ROLE writer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE USER IF NOT EXISTS analyst_user\nIDENTIFIED WITH sha256_password BY 'Analyst@Password123!'\nDEFAULT ROLE analyst_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- ========================================\n-- SQL Block 3\n-- ========================================\n\n-- 创建 LDAP 用户\nCREATE USER IF NOT EXISTS ldap_analyst\nIDENTIFIED WITH ldap_server 'company_ldap'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 分配角色\nCREATE ROLE IF NOT EXISTS analyst_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON *.* TO analyst_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT analyst_role TO ldap_analyst",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `ldap_analyst` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 4\n-- ========================================\n\n-- 1. 创建角色（细粒度权限）\nCREATE ROLE IF NOT EXISTS admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS readonly_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS writer_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS analyst_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS security_admin_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS audit_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 2. 分配权限\nGRANT ALL ON *.* TO admin_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON analytics.*, sales.*, marketing.* TO readonly_role",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 35 (.): .*, marketing.* TO readonly_role\n. Expected access type. (SYNTAX_ERROR) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT SELECT ON system.* TO readonly_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT SELECT, INSERT ON analytics.*, sales.*, marketing.* TO writer_role",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 43 (.): .*, marketing.* TO writer_role\n. Expected access type. (SYNTAX_ERROR) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT SELECT, ALTER UPDATE, ALTER DELETE ON analytics.*, sales.*, marketing.* TO analyst_role",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 63 (.): .*, marketing.* TO analyst_role\n. Expected access type. (SYNTAX_ERROR) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT SELECT ON system.query_log TO audit_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT SELECT ON system.error_log TO audit_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT SELECT ON system.mutation_log TO audit_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT SELECT ON security.* TO audit_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 3. 创建用户（限制资源）\nCREATE USER IF NOT EXISTS admin\nIDENTIFIED WITH sha256_password BY 'Admin@SecurePassword123!'\nDEFAULT ROLE admin_role\nSETTINGS access_management = 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS readonly_user\nIDENTIFIED WITH sha256_password BY 'ReadOnly@Password123!'\nDEFAULT ROLE readonly_role\nSETTINGS\n    max_memory_usage = 10000000000,\n    max_execution_time = 600",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE USER IF NOT EXISTS analyst_user\nIDENTIFIED WITH sha256_password BY 'Analyst@Password123!'\nDEFAULT ROLE analyst_role\nSETTINGS\n    max_memory_usage = 20000000000,\n    max_execution_time = 1800",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE USER IF NOT EXISTS audit_user\nIDENTIFIED WITH sha256_password BY 'Audit@Password123!'\nDEFAULT ROLE audit_role\nSETTINGS\n    max_memory_usage = 5000000000,\n    max_execution_time = 300",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 4. 创建审计告警\nCREATE TABLE IF NOT EXISTS security.alerts\n(\n    alert_id UUID,\n    alert_type String,\n    alert_level Enum8('info' = 1, 'warning' = 2, 'error' = 3, 'critical' = 4),\n    message String,\n ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 5. 创建安全事件监控视图\nCREATE MATERIALIZED VIEW IF NOT EXISTS security.security_alerts_mv\nTO security.alerts\nAS SELECT\n    generateUUIDv4() as alert_id,\n    'access_denied' as alert_type,\n    'critical'::En",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 5\n-- ========================================\n\n-- 1. 创建租户表\nCREATE TABLE IF NOT EXISTS multi_tenant.orders\nON CLUSTER 'treasurycluster'\n(\n    or",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. 创建租户用户\nCREATE USER IF NOT EXISTS tenant1\nIDENTIFIED WITH sha256_password BY 'Tenant1@Password123!'\nSETTINGS tenant_id = 'tenant1'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS tenant2\nIDENTIFIED WITH sha256_password BY 'Tenant2@Password123!'\nSETTINGS tenant_id = 'tenant2'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting tenant_id is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build)"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS tenant3\nIDENTIFIED WITH sha256_password BY 'Tenant3@Password123!'\nSETTINGS tenant_id = 'tenant3'",
        "success": false,
        "result": "HTTP 404: Code: 115. DB::Exception: Setting tenant_id is neither a builtin setting nor started with the prefix 'SQL_' registered for user-defined settings. (UNKNOWN_SETTING) (version 25.12.3.21 (official build)"
      },
      {
        "statement": "-- 3. 创建租户角色\nCREATE ROLE IF NOT EXISTS tenant_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT, INSERT ON multi_tenant.* TO tenant_role",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `tenant_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT tenant_role TO tenant1",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `tenant1` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT tenant_role TO tenant2",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `tenant2` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "GRANT tenant_role TO tenant3",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `tenant3` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- 4. 创建行级安全策略\nCREATE ROW POLICY IF NOT EXISTS tenant_filter\nON multi_tenant.orders\nUSING tenant_id = current_user_settings['tenant_id']\nAS RESTRICTIVE TO tenant1, tenant2, tenant3",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 5. 创建租户监控视图\nCREATE VIEW IF NOT EXISTS multi_tenant.tenant_stats AS\nSELECT \n    tenant_id,\n    count() as order_count,\n    sum(amount) as total_amount,\n    avg(amount) as avg_amount,\n    toYYYYMM(cr",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 6\n-- ========================================\n\n-- 1. 创建资源受限的角色\nCREATE ROLE IF NOT EXISTS small_tenant_role\nGRANT SELECT, INSERT ON multi_tenant",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS medium_tenant_role\nGRANT SELECT, INSERT ON multi_tenant.* TO medium_tenant_role\nSETTINGS\n    max_memory_usage = 10000000000,     -- 10 GB\n    max_execution_time = 1800,      ",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 46 (GRANT) (line 2, col 1): GRANT SELECT, INSERT ON multi_tenant.* TO medium_tenant_role\nSETTINGS\n    max_memory_usage = 10000000000,     \n   "
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS large_tenant_role\nGRANT SELECT, INSERT ON multi_tenant.* TO large_tenant_role\nSETTINGS\n    max_memory_usage = 20000000000,     -- 20 GB\n    max_execution_time = 3600,        ",
        "success": false,
        "result": "HTTP 400: Code: 62. DB::Exception: Syntax error: failed at position 45 (GRANT) (line 2, col 1): GRANT SELECT, INSERT ON multi_tenant.* TO large_tenant_role\nSETTINGS\n    max_memory_usage = 20000000000,     \n    "
      },
      {
        "statement": "-- 2. 为租户分配不同的角色\nCREATE USER IF NOT EXISTS small_tenant\nIDENTIFIED WITH sha256_password BY 'SmallTenant@Password123!'\nSETTINGS tenant_id = 'small_tenant'\nDEFAULT ROLE small_tenant_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS medium_tenant\nIDENTIFIED WITH sha256_password BY 'MediumTenant@Password123!'\nSETTINGS tenant_id = 'medium_tenant'\nDEFAULT ROLE medium_tenant_role",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `medium_tenant_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "CREATE USER IF NOT EXISTS large_tenant\nIDENTIFIED WITH sha256_password BY 'LargeTenant@Password123!'\nSETTINGS tenant_id = 'large_tenant'\nDEFAULT ROLE large_tenant_role",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `large_tenant_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- 3. 创建资源监控视图\nCREATE VIEW IF NOT EXISTS multi_tenant.resource_usage AS\nSELECT \n    user,\n    count() as query_count,\n    sum(read_rows) as total_read_rows,\n    sum(read_bytes) / 1024 / 1024 / 1024 as",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 7\n-- ========================================\n\n-- 1. 创建数据访问日志表\nCREATE TABLE IF NOT EXISTS compliance.data_access_log\nON CLUSTER 'treasurycluste",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. 创建 PII 数据表\nCREATE TABLE IF NOT EXISTS compliance.user_pii\nON CLUSTER 'treasurycluster'\n(\n    user_id String,\n    encrypted_name String,  -- 加密\n    encrypted_email String,  -- 加密\n    encrypted_ph",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 3. 创建数据删除请求视图\nCREATE VIEW IF NOT EXISTS compliance.deletion_requests AS\nSELECT \n    user_id,\n    encrypted_name,\n    encrypted_email,\n    deletion_requested,\n    data_retention_date,\n    now() as r",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 4. 创建访问监控视图\nCREATE MATERIALIZED VIEW IF NOT EXISTS compliance.access_monitor_mv\nTO compliance.data_access_log\nAS SELECT\n    generateUUIDv4() as access_id,\n    user,\n    '' as accessed_user_id,\n    ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- SQL Block 8\n-- ========================================\n\n-- 1. 创建 PHI 数据表\nCREATE TABLE IF NOT EXISTS compliance.patient_phi\nON CLUSTER 'treasurycluster'\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2. 创建 HIPAA 角色和权限\nCREATE ROLE IF NOT EXISTS doctor_role",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "GRANT SELECT ON compliance.patient_phi TO doctor_role",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `doctor_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "CREATE ROW POLICY IF NOT EXISTS doctor_access_filter\nON compliance.patient_phi\nUSING access_level = 'doctor'\nAS RESTRICTIVE TO doctor_role",
        "success": false,
        "result": "HTTP 404: Code: 511. DB::Exception: There is no role `doctor_role` in `user directories`. (UNKNOWN_ROLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "CREATE ROLE IF NOT EXISTS nurse_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "GRANT SELECT(patient_id, encrypted_name, encrypted_diagnosis) ON compliance.patient_phi TO nurse_role",
        "success": true,
        "result": ""
      },
      {
        "statement": "CREATE ROW POLICY IF NOT EXISTS nurse_access_filter\nON compliance.patient_phi\nUSING access_level IN ('doctor', 'nurse')\nAS RESTRICTIVE TO nurse_role",
        "success": true,
        "result": ""
      }
    ]
  }
}