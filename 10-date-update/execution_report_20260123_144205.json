{
  "timestamp": "2026-01-23T14:42:05.802987",
  "directory": "10-date-update",
  "summary": {
    "total_files": 9,
    "total_statements": 329,
    "total_success": 328,
    "total_errors": 1
  },
  "results": {
    "10-date-update\\01_date_time_types_examples.sql": [
      {
        "statement": "-- ================================================\n-- 01_date_time_types_examples.sql\n-- 从 01_date_time_types.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- ===========================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 插入数据\nINSERT INTO date_demo VALUES\n    (1, toDate('2024-01-20')),\n    (2, toDate('2024-01-21'))",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询\nSELECT \n    date_col,\n    toTypeName(date_col) AS type,\n    toUnixTimestamp(date_col) AS unix_timestamp\nFROM date_demo",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- Date32 类型：扩展范围，4 字节\nCREATE TABLE date32_demo (\n    id UInt64,\n    date_col Date32\n) ENGINE = Merg",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 插入数据\nINSERT INTO date32_demo VALUES\n    (1, toDate32('2024-01-20')),\n    (2, toDate32('1900-01-01')),\n    (3, toDate32('2299-12-31'))",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询\nSELECT \n    date_col,\n    toTypeName(date_col) AS type\nFROM date32_demo",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- DateTime 类型：精确到秒，4 字节\nCREATE TABLE datetime_demo (\n    id UInt64,\n    datetime_col DateTime\n) ENG",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 插入数据\nINSERT INTO datetime_demo VALUES\n    (1, toDateTime('2024-01-20 12:34:56')),\n    (2, toDateTime('2024-01-21 15:30:00'))",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询\nSELECT \n    datetime_col,\n    toTypeName(datetime_col) AS type,\n    toUnixTimestamp(datetime_col) AS unix_timestamp\nFROM datetime_demo",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- DateTime64 类型：可配置精度，8 字节\nCREATE TABLE datetime64_demo (\n    id UInt64,\n    datetime_col DateTime6",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 插入数据\nINSERT INTO datetime64_demo VALUES\n    (1, toDateTime64('2024-01-20 12:34:56.789', 3)),\n    (2, now64(6))",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 微秒精度\n\n-- 查询\nSELECT \n    datetime_col,\n    toTypeName(datetime_col) AS type,\n    toUnixTimestamp64Milli(datetime_col) AS unix_timestamp_ms\nFROM datetime64_demo",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- 使用 Date 类型存储生日\nCREATE TABLE users (\n    id UInt64,\n    name String,\n    birth_date Date\n) ENGINE ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询今天过生日的用户\nSELECT * FROM users\nWHERE \n    toMonth(birth_date) = toMonth(today())\n    AND toDayOfMonth(birth_date) = toDayOfMonth(today())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- 使用 DateTime 存储事件时间\nCREATE TABLE events (\n    id UInt64,\n    event_time DateTime,\n    event_type S",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询最近 1 小时的事件\nSELECT * FROM events\nWHERE event_time >= now() - INTERVAL 1 HOUR",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- 使用 DateTime64 存储微秒级时间\nCREATE TABLE sensor_data (\n    sensor_id UInt64,\n    reading_time DateTime6",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 插入高精度数据\nINSERT INTO sensor_data VALUES\n    (1, now64(6), 25.6),\n    (2, toDateTime64('2024-01-20 12:34:56.789012', 6), 23.4)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- 使用 DateTime 处理多时区数据\nCREATE TABLE global_events (\n    id UInt64,\n    event_time DateTime,  -- UTC ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询并转换为本地时区\nSELECT \n    event_time AS utc_time,\n    toTimezone(event_time, 'Asia/Shanghai') AS beijing_time,\n    toTimezone(event_time, 'America/New_York') AS ny_time,\n    description\nFROM global_ev",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- 字符串转 Date\nSELECT toDate('2024-01-20')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "SELECT toDate32('2024-01-20')",
        "success": true,
        "result": "2024-01-20"
      },
      {
        "statement": "-- 字符串转 DateTime\nSELECT toDateTime('2024-01-20 12:34:56')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "SELECT toDateTime('2024-01-20T12:34:56')",
        "success": true,
        "result": "2024-01-20 12:34:56"
      },
      {
        "statement": "-- ISO 格式\n\n-- Unix 时间戳转 DateTime\nSELECT toDateTime(1705757696)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- Date 转 DateTime\nSELECT toDateTime(toDate('2024-01-20'))",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- DateTime 转 Date\nSELECT toDate(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- DateTime64 转 DateTime\nSELECT toDateTime(toDateTime64('2024-01-20 12:34:56.789', 3))",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- ClickHouse 会在某些情况下自动转换\nSELECT '2024-01-20'::Date AS date_val",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 比较时的自动转换\nSELECT now() > '2024-01-20'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 字符串自动转 DateTime\n\n-- ========================================\n-- Date 类型\n-- ========================================\n\n-- 比较不同类型的存储效率\nCREATE TABLE storage_test (\n    id UInt64,\n    date_col Date,\n   ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 插入 1000 万行测试数据\n-- 分析存储占用\nSELECT\n    'Date' as type,\n    formatReadableSize(sum(data_compressed_bytes)) as compressed,\n    formatReadableSize(sum(data_uncompressed_bytes)) as uncompressed\nFROM syste",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- 不同类型的查询性能\n-- Date 类型查询（最快）\nSELECT count() FROM storage_test\nWHERE date_col = '2024-01-20'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- DateTime 类型查询（快）\nSELECT count() FROM storage_test\nWHERE datetime_col = toDateTime('2024-01-20 00:00:00')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- DateTime64 类型查询（较慢）\nSELECT count() FROM storage_test\nWHERE datetime64_col = toDateTime64('2024-01-20 00:00:00.000', 3)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- ❌ 错误：假设所有时间都是本地时间\nSELECT * FROM events\nWHERE event_time = '2024-01-20 12:00:00'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 正确：使用 UTC 时间\nSELECT * FROM events\nWHERE event_time = toDateTime('2024-01-20 12:00:00', 'UTC')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- ❌ 错误：使用 DateTime 丢失微秒精度\n-- 存储时：2024-01-20 12:34:56.789\n-- 读取时：2024-01-20 12:34:56\n\n-- ✅ 正确：使用 Dat",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- Date 类型\n-- ========================================\n\n-- ❌ 错误：Date 类型范围超出\nINSERT INTO date_demo VALUES (1, toDate('1800-01-01'))",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 失败\n\n-- ✅ 正确：使用 Date32\nCREATE TABLE wide_date_range (\n    date_col Date32\n) ENGINE = MergeTree()\nORDER BY date_col",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "10-date-update\\02_date_time_functions_examples.sql": [
      {
        "statement": "-- ================================================\n-- 02_date_time_functions_examples.sql\n-- 从 02_date_time_functions.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- ===================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- DateTime\nSELECT now64(6)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- DateTime64(6)\n\n-- 当前日期\nSELECT today()",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- Date\nSELECT yesterday()",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- Date\nSELECT tomorrow()",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- Date\n\n-- 当前 Unix 时间戳\nSELECT toUnixTimestamp(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt32\nSELECT toUnixTimestamp64Milli(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt64\nSELECT toUnixTimestamp64Micro(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt64\nSELECT toUnixTimestamp64Nano(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt64\n\n-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 转换为 DateTime\nSELECT toDateTime('2024-01-20 12:34:56')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "SELECT toDateTime(1705757696)",
        "success": true,
        "result": "2024-01-20 13:34:56"
      },
      {
        "statement": "-- Unix 时间戳\nSELECT toDateTime64('2024-01-20 12:34:56.789', 3)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 转换为 Date\nSELECT toDate('2024-01-20')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "SELECT toDate('2024-01-20 12:34:56')",
        "success": true,
        "result": "2024-01-20"
      },
      {
        "statement": "-- 时间部分被忽略\nSELECT toDate32('2024-01-20')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 转换为字符串\nSELECT formatDateTime(now(), '%Y-%m-%d %H:%M:%S')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "SELECT formatDateTime(now(), '%Y年%m月%d日 %H时%M分%S秒')",
        "success": true,
        "result": "2026年01月23日 06时January分51秒"
      },
      {
        "statement": "SELECT toISOYear(now())",
        "success": true,
        "result": "2026"
      },
      {
        "statement": "SELECT toISOWeek(now())",
        "success": true,
        "result": "4"
      },
      {
        "statement": "-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 提取年\nSELECT toYear(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt16\nSELECT toYear('2024-01-20')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 2024\n\n-- 提取季度\nSELECT toQuarter(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt8 (1-4)\nSELECT toQuarter('2024-01-20')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 1\n\n-- 提取月\nSELECT toMonth(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt8 (1-12)\nSELECT toMonth('2024-01-20')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 1\n\n-- 提取日\nSELECT toDayOfMonth(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt8 (1-31)\nSELECT toDayOfMonth('2024-01-20')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 20\n\n-- 提取星期\nSELECT toDayOfWeek(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt8 (0-6, 0=周一)\nSELECT toDayOfWeek('2024-01-20')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 6 (周六)\n\n-- 提取小时\nSELECT toHour(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt8 (0-23)\nSELECT toMinute(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt8 (0-59)\nSELECT toSecond(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt8 (0-59)\n\n-- 提取年中的第几天\nSELECT toDayOfYear(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt16 (1-366)\n\n-- 提取周中的第几天\nSELECT toISOWeek(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- UInt16 (1-53)\n\n-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- DateTime 转 Unix 时间戳\nSELECT toUnixTimestamp(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 秒\nSELECT toUnixTimestamp64Milli(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 毫秒\nSELECT toUnixTimestamp64Micro(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 微秒\nSELECT toUnixTimestamp64Nano(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 纳秒\n\n-- Unix 时间戳转 DateTime\nSELECT toDateTime(1705757696)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "SELECT toDateTime64(1705757696000, 3)",
        "success": true,
        "result": "2299-12-31 23:59:59.000"
      },
      {
        "statement": "-- 毫秒\nSELECT toDateTime64(1705757696000000, 6)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 微秒\n\n-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 时间对齐到开始\nSELECT toStartOfDay(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 当天 00:00:00\nSELECT toStartOfHour(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 当前小时 00:00\nSELECT toStartOfMinute(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 当前分钟 00:00\nSELECT toStartOfMonth(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 当月 1 日 00:00:00\nSELECT toStartOfQuarter(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 当前季度第一天\nSELECT toStartOfYear(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 当年 1 月 1 日\nSELECT toStartOfWeek(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 周一 00:00:00\nSELECT toStartOfISOWeek(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ISO 周一\nSELECT toStartOfInterval(now(), INTERVAL 1 DAY)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 时间对齐到结束\nSELECT toEndOfDay(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 当天 23:59:59\nSELECT toEndOfMonth(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 当月最后一天 23:59:59\nSELECT toEndOfQuarter(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 当前季度最后一天\nSELECT toEndOfYear(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 当年 12 月 31 日\n\n-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 格式化日期时间\nSELECT formatDateTime(now(), '%Y-%m-%d %H:%M:%S')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 输出: 2024-01-20 12:34:56\n\n-- 格式化选项\nSELECT \n    formatDateTime(now(), '%Y') AS year,           -- 2024\n    formatDateTime(now(), '%m') AS month,          -- 01\n    formatDateTime(now(), '%d') AS day,",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 020\n\n-- 自定义格式\nSELECT formatDateTime(now(), '%Y年%m月%d日 %H时%M分%S秒')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 输出: 2024年01月20日 12时34分56秒\n\nSELECT formatDateTime(now(), 'Today is %A, %B %d, %Y')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 输出: Today is Saturday, January 20, 2024\n\n-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 解析日期字符串\nSELECT parseDateTime('2024-01-20 12:34:56')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- DateTime\nSELECT parseDateTime('2024/01/20', '%Y/%m/%d')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 指定格式\nSELECT parseDateTimeBestEffort('2024-01-20T12:34:56')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 智能解析\n\n-- 解析日期（无时间）\nSELECT parseDateTimeBestEffort('2024-01-20')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- DateTime (00:00:00)\n\n-- 从时间戳解析\nSELECT parseDateTimeBestEffort('1705757696')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 获取当前周的日期范围\nSELECT\n    toStartOfWeek(now()) AS week_start,\n    toEndOfWeek(now()) AS week_end",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 获取当前月的日期范围\nSELECT\n    toStartOfMonth(now()) AS month_start,\n    toEndOfMonth(now()) AS month_end",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 获取当前季度的日期范围\nSELECT\n    toStartOfQuarter(now()) AS quarter_start,\n    toEndOfQuarter(now()) AS quarter_end",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 计算两个时间的差异\nSELECT\n    dateDiff('second', '2024-01-01', '2024-01-20') AS diff_seconds,\n    dateDiff(",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 按天聚合\nSELECT\n    toStartOfDay(event_time) AS day,\n    count() AS event_count\nFROM events\nWHERE even",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 按小时聚合\nSELECT\n    toStartOfHour(event_time) AS hour,\n    count() AS event_count\nFROM events\nWHERE event_time >= toStartOfDay(now())\nGROUP BY hour\nORDER BY hour",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 按月聚合\nSELECT\n    toStartOfMonth(event_time) AS month,\n    count() AS event_count\nFROM events\nWHERE event_time >= toStartOfMonth(now() - INTERVAL 12 MONTH)\nGROUP BY month\nORDER BY month",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 滑动窗口\nSELECT\n    event_time,\n    event_type,\n    avg(value) OVER (\n        PARTITION BY event_type\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 时间范围窗口\nSELECT\n    event_time,\n    event_type,\n    avg(value) OVER (\n        PARTITION BY event_type\n        ORDER BY event_time\n        RANGE BETWEEN INTERVAL 1 HOUR PRECEDING AND CURRENT ROW\n    )",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 验证日期是否有效\nSELECT\n    isValidDateTime('2024-01-20 12:34:56') AS is_valid,\n    isValidDateTime('2024-",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 处理无效日期\nSELECT\n    date_str,\n    parseDateTimeBestEffort(date_str) AS parsed_date,\n    isValidDateTime(parseDateTimeBestEffort(date_str)) AS is_valid\nFROM (\n    SELECT '2024-01-20' AS date_str\n    U",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 转换为不同精度的时间戳\nSELECT\n    toUnixTimestamp(now()) AS ts_seconds,\n    toUnixTimestamp64Milli(now()) AS ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 比较时间戳\nSELECT\n    now() > toDateTime(1705757696) AS is_after,\n    now() < toDateTime(2100-01-01) AS is_before",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 时间戳差\nSELECT\n    toUnixTimestamp(now()) - toUnixTimestamp(toDateTime('2024-01-01')) AS seconds_since_start",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 计算下一个周期时间\nSELECT\n    now() AS current_time,\n    addWeeks(now(), 1) AS next_week,\n    addMonths(now",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 计算上一个周期时间\nSELECT\n    now() AS current_time,\n    subtractDays(now(), 7) AS last_week,\n    subtractMonths(now(), 1) AS last_month,\n    subtractYears(now(), 1) AS last_year",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 相对时间\nSELECT\n    now() + INTERVAL 1 DAY AS tomorrow,\n    now() - INTERVAL 1 HOUR AS one_hour_ago,\n    now() + INTERVAL 30 MINUTE AS in_30_minutes",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 转换时区\nSELECT\n    now() AS utc_time,\n    toTimezone(now(), 'Asia/Shanghai') AS beijing_time,\n    toT",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 获取时区信息\nSELECT\n    timezone() AS current_timezone,\n    toTimezone(now(), 'UTC') AS utc_time",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取当前时间\n-- ========================================\n\n-- 生成时间序列\nSELECT \n    arrayJoin([\n        toStartOfDay(now()) - INTERVAL n DAY\n        FOR n IN (0, 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 生成更复杂的时间序列\nSELECT\n    toDate('2024-01-01') + INTERVAL toUInt32(number) DAY\nFROM numbers(30)\nWHERE toDate('2024-01-01') + INTERVAL toUInt32(number) DAY <= toDate('2024-01-30')",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "10-date-update\\03_time_zones_examples.sql": [
      {
        "statement": "-- ================================================\n-- 03_time_zones_examples.sql\n-- 从 03_time_zones.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- ================================================\n\n\n--",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 例如：Asia/Shanghai\n\n-- 查看所有可用时区\nSELECT * FROM system.time_zones \nORDER BY name\nLIMIT 100",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 搜索特定时区\nSELECT name, offset \nFROM system.time_zones\nWHERE name LIKE 'Asia/%'\nORDER BY name",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 转换时间到不同时区\nSELECT\n    now() AS utc_time,\n    toTimezone(now(), 'Asia/Shanghai') AS beijing_time,\n ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 假设数据库存储 UTC 时间\n-- 创建表时指定 UTC 时区\nCREATE TABLE events (\n    id UInt64,\n    event_time DateTime('UTC",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询时转换为本地时区\nSELECT\n    event_time AS utc_time,\n    toTimezone(event_time, 'Asia/Shanghai') AS beijing_time,\n    event_data\nFROM events\nLIMIT 10",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 查询特定时区的时间范围\nSELECT *\nFROM events\nWHERE toTimezone(event_time, 'Asia/Shanghai') \n    >= toDateTime",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 按本地时区分组\nSELECT\n    toStartOfDay(toTimezone(event_time, 'Asia/Shanghai')) AS beijing_day,\n    count() AS event_count\nFROM events\nGROUP BY beijing_day\nORDER BY beijing_day",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 存储用户时区\nCREATE TABLE users (\n    id UInt64,\n    name String,\n    timezone String,  -- 用户时区，如 'Asia",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 插入用户\nINSERT INTO users VALUES\n    (1, '张三', 'Asia/Shanghai', now('UTC')),\n    (2, '李四', 'America/New_York', now('UTC')),\n    (3, '王五', 'Europe/London', now('UTC'))",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 按用户时区显示\nSELECT\n    name,\n    timezone,\n    toTimezone(created_at, timezone) AS local_created_at\nFROM users",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 记录事件和时区\nCREATE TABLE global_events (\n    id UInt64,\n    event_time DateTime('UTC'),\n    event_tim",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 插入事件\nINSERT INTO global_events VALUES\n    (1, now('UTC'), 'Asia/Shanghai', '上海事件'),\n    (2, now('UTC'), 'America/New_York', '纽约事件'),\n    (3, now('UTC'), 'Europe/London', '伦敦事件')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询并转换为所有时区\nSELECT\n    event_time AS utc_time,\n    toTimezone(event_time, 'Asia/Shanghai') AS shanghai_time,\n    toTimezone(event_time, 'America/New_York') AS ny_time,\n    toTimezone(event_time, 'Eu",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 按用户时区生成每日报告\nSELECT\n    user_id,\n    user_timezone,\n    toStartOfDay(toTimezone(event_time, user_t",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 夏令时地区的事件\nCREATE TABLE dst_events (\n    id UInt64,\n    event_time DateTime('UTC'),\n    location_ti",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 插入数据\nINSERT INTO dst_events VALUES\n    (1, toDateTime('2024-03-10 12:00:00', 'UTC'), 'America/New_York', 'DST start'),\n    (2, toDateTime('2024-11-03 12:00:00', 'UTC'), 'America/New_York', 'DST end",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询并显示 UTC 和本地时间\nSELECT\n    event_time AS utc_time,\n    toTimezone(event_time, location_timezone) AS local_time,\n    event_type\nFROM dst_events",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 按本地时区聚合\nSELECT\n    user_timezone,\n    toStartOfDay(toTimezone(event_time, user_timezone)) AS loca",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 计算每个时区的活动小时\nSELECT\n    user_timezone,\n    toHour(toTimezone(event_time, user_timezone)) AS local_hour,\n    count() AS event_count\nFROM user_events\nWHERE event_time >= now('UTC') - INTERVAL 7 DAY\nGR",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 创建表时指定时区\nCREATE TABLE events_beijing (\n    id UInt64,\n    event_time DateTime('Asia/Shanghai'),  ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询时自动使用表的时区\nSELECT event_time FROM events_beijing",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 仍可转换为其他时区\nSELECT\n    event_time AS beijing_time,\n    toTimezone(event_time, 'UTC') AS utc_time\nFROM events_beijing",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 在查询中临时转换时区\nSELECT\n    event_time AS original_time,\n    toTimezone(event_time, 'Asia/Shanghai') AS",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 获取当前时区偏移\nSELECT\n    timezone() AS current_timezone,\n    toTimezone(now(), timezone()) - now() AS ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 获取时区名称\nSELECT timezone() AS timezone_name",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 获取时区缩写\nSELECT timezone() AS timezone,\n       timezones['Asia/Shanghai'] AS timezone_info",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- 计算时区偏移\nSELECT\n    'UTC' AS timezone,\n    now() AS time",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "SELECT\n    'Asia/Shanghai' AS timezone,\n    toTimezone(now(), 'Asia/Shanghai') AS time,\n    toTimezone(now(), 'Asia/Shanghai') - now() AS offset_seconds",
        "success": true,
        "result": "Asia/Shanghai\t2026-01-23 14:41:56\t0"
      },
      {
        "statement": "SELECT\n    'America/New_York' AS timezone,\n    toTimezone(now(), 'America/New_York') AS time,\n    toTimezone(now(), 'America/New_York') - now() AS offset_seconds",
        "success": true,
        "result": "America/New_York\t2026-01-23 01:41:56\t0"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- ❌ 错误：直接存储本地时间\nCREATE TABLE events (\n    event_time DateTime  -- 使用服务器时区，可能是错误的\n) ENGINE = MergeTr",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 正确：存储 UTC 时间\nCREATE TABLE events (\n    event_time DateTime('UTC')  -- 明确指定 UTC\n) ENGINE = MergeTree()\nORDER BY event_time",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- ❌ 错误：使用固定偏移\nSELECT \n    event_time,\n    event_time + INTERVAL 8 HOUR AS beijing_time  -- 错误，没有考虑夏",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 正确：使用时区转换\nSELECT \n    event_time,\n    toTimezone(event_time, 'Asia/Shanghai') AS beijing_time\nFROM events",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 获取和设置时区\n-- ========================================\n\n-- ❌ 错误：不同表使用不同时区\nCREATE TABLE events_utc (\n    event_time DateTime('UTC')\n) ENGINE = MergeTree()\nOR",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE TABLE events_local (\n    event_time DateTime  -- 服务器时区\n) ENGINE = MergeTree()\nORDER BY event_time",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- ✅ 正确：所有表使用统一时区（UTC）\nCREATE TABLE events (\n    event_time DateTime('UTC')\n) ENGINE = MergeTree()\nORDER BY event_time",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "10-date-update\\04_date_arithmetic_examples.sql": [
      {
        "statement": "-- ================================================\n-- 04_date_arithmetic_examples.sql\n-- 从 04_date_arithmetic.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- ===========================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 减法：减去时间间隔\nSELECT \n    now() - INTERVAL 1 DAY AS yesterday,\n    now() - INTERVAL 1 WEEK AS last_week,\n    now() - INTERVAL 1 MONTH AS last_month,\n    now() - INTERVAL 1 YEAR AS last_year,\n    now() ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 使用不同的时间间隔单位\nSELECT \n    now() + INTERVAL 1 SECOND AS add_second,\n    now() + INTERVAL 1 MINUTE AS ad",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 组合时间间隔\nSELECT \n    now() + INTERVAL 1 DAY + INTERVAL 2 HOURS AS combined,\n    now() + INTERVAL 1 MONTH - INTERVAL 7 DAYS AS combined2",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 使用专用函数\nSELECT \n    addDays(now(), 1) AS tomorrow,\n    addDays(now(), -1) AS yesterday,\n    addWeeks(",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "SELECT \n    subtractDays(now(), 7) AS 7_days_ago,\n    subtractMonths(now(), 1) AS last_month,\n    subtractYears(now(), 1) AS last_year",
        "success": true,
        "result": "2026-01-16 06:41:57\t2025-12-23 06:41:57\t2025-01-23 06:41:57"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 使用 Unix 时间戳运算\nSELECT \n    toDateTime(toUnixTimestamp(now()) + 86400) AS tomorrow_seconds,  -- +24小时\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 毫秒级精度\nSELECT \n    toDateTime64(toUnixTimestamp64Milli(now64(3)) + 86400000, 3) AS tomorrow_millis",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 订阅到期时间\nSELECT\n    user_id,\n    subscription_start,\n    subscription_duration_months,\n    addMonths(s",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 计算用户活跃度\nSELECT\n    user_id,\n    last_login,\n    dateDiff('day', last_login, now()) AS days_since_las",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 7 天滚动窗口\nSELECT\n    toStartOfDay(event_time) AS day,\n    count() AS event_count,\n    sum(count()) OVE",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 计算年龄\nSELECT\n    user_id,\n    birth_date,\n    dateDiff('year', birth_date, now()) AS age,\n    dateDif",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 计算事件间隔\nSELECT\n    user_id,\n    event_time,\n    event_time - lagInFrame(event_time) OVER (PARTITION B",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 计算工作日\nSELECT\n    event_date,\n    toDayOfWeek(event_date) AS day_of_week,\n    CASE \n        WHEN toDa",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 计算月末\nSELECT\n    event_date,\n    toEndOfMonth(event_date) AS month_end,\n    event_date = toEndOfMonth(event_date) AS is_month_end",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 计算季度\nSELECT\n    event_date,\n    toQuarter(event_date) AS quarter,\n    toStartOfQuarter(event_date) A",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 计算年初至今（YTD）\nSELECT\n    event_date,\n    amount,\n    sum(amount) OVER (\n        PARTITION BY toYear(ev",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 创建带预计算时间列的表\nCREATE TABLE events (\n    id UInt64,\n    event_time DateTime,\n    event_date Date MATERI",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询时使用预计算列\nSELECT\n    event_date,\n    event_hour,\n    count() AS event_count\nFROM events\nWHERE event_date >= today() - INTERVAL 30 DAY\nGROUP BY event_date, event_hour\nORDER BY event_date, event_hour",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- 创建物化视图预聚合\nCREATE MATERIALIZED VIEW daily_events_mv\nENGINE = SummingMergeTree()\nPARTITION BY toYYYYMM",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询物化视图（快速）\nSELECT\n    event_date,\n    event_type,\n    event_count\nFROM daily_events_mv\nWHERE event_date >= today() - INTERVAL 30 DAY\nORDER BY event_date, event_type",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- ❌ 错误：不考虑时区\nSELECT now() + INTERVAL 8 HOUR AS beijing_time",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 正确：显式转换时区\nSELECT toTimezone(now(), 'Asia/Shanghai') AS beijing_time",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间加减\n-- ========================================\n\n-- ❌ 错误：假设所有月份都有 30 天\nSELECT addDays(now(), 30) AS one_month_later",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 不准确\n\n-- ✅ 正确：使用 addMonths\nSELECT addMonths(now(), 1) AS one_month_later",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 准确\n\n-- ========================================\n-- 时间加减\n-- ========================================\n\n-- ❌ 错误：可能导致溢出\nSELECT addYears(toDate('2100-01-01'), 10)",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 超出范围\n\n-- ✅ 正确：检查范围\nSELECT \n    if(addYears(toDate('2100-01-01'), 10) > toDate('2106-02-03'), \n        toDate('2106-02-03'),  -- 最大值\n        addYears(toDate('2100-01-01'), 10)) AS safe_date",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "10-date-update\\05_time_range_queries_examples.sql": [
      {
        "statement": "-- ================================================\n-- 05_time_range_queries_examples.sql\n-- 从 05_time_range_queries.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- =====================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 使用 INTERVAL\nSELECT * FROM events\nWHERE event_time >= now() - INTERVAL 7 DAY\n  AND event_time < now()",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 使用函数\nSELECT * FROM events\nWHERE event_time >= toStartOfDay(now())\n  AND event_time < toStartOfDay(now()) + INTERVAL 1 DAY",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 使用 toStartOfDay\nSELECT * FROM events\nWHERE event_time >= toStartOfDay(now() - INTERVAL 7 DAY)\n  AN",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 使用 toStartOfMonth\nSELECT * FROM events\nWHERE event_time >= toStartOfMonth(now())\n  AND event_time < toEndOfMonth(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 使用 toStartOfYear\nSELECT * FROM events\nWHERE event_time >= toStartOfYear(now())\n  AND event_time < toStartOfYear(now()) + INTERVAL 1 YEAR",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 最近 N 天\nSELECT * FROM events\nWHERE event_time >= now() - INTERVAL 1 DAY",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 最近 1 天\nSELECT * FROM events\nWHERE event_time >= now() - INTERVAL 7 DAY",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 最近 7 天\nSELECT * FROM events\nWHERE event_time >= now() - INTERVAL 30 DAY",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 最近 30 天\n\n-- 最近 N 小时\nSELECT * FROM events\nWHERE event_time >= now() - INTERVAL 1 HOUR",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 最近 1 小时\nSELECT * FROM events\nWHERE event_time >= now() - INTERVAL 24 HOUR",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 最近 24 小时\n\n-- 最近 N 分钟\nSELECT * FROM events\nWHERE event_time >= now() - INTERVAL 5 MINUTE",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 最近 5 分钟\nSELECT * FROM events\nWHERE event_time >= now() - INTERVAL 60 MINUTE",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 最近 60 分钟\n\n-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 本周\nSELECT * FROM events\nWHERE event_time >= toStartOfWeek(now())\n  AND event_time < t",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 本月\nSELECT * FROM events\nWHERE event_time >= toStartOfMonth(now())\n  AND event_time < toEndOfMonth(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 本季度\nSELECT * FROM events\nWHERE event_time >= toStartOfQuarter(now())\n  AND event_time < toEndOfQuarter(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 本年\nSELECT * FROM events\nWHERE event_time >= toStartOfYear(now())\n  AND event_time < toEndOfYear(now())",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 假设表按月分区\n-- PARTITION BY toYYYYMM(event_time)\n\n-- 查询会自动使用分区裁剪\nSELECT * FROM events\nWHERE event_time",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 只扫描 2024-01 分区\n\n-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 好的分区键设计\nCREATE TABLE events (\n    id UInt64,\n    event_time DateTime,\n    data ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询时自动裁剪\nSELECT * FROM events\nWHERE event_time >= '2024-01-01'\n  AND event_time < '2024-02-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 只扫描 1 个分区\n\n-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 按天聚合\nSELECT\n    toStartOfDay(event_time) AS day,\n    count() AS event_count,\n    avg",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 按小时聚合\nSELECT\n    toStartOfHour(event_time) AS hour,\n    count() AS event_count,\n    avg(value) AS ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 对比本周和上周\nSELECT\n    'This Week' AS period,\n    count() AS event_count\nFROM events\nWHERE event_time ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 生成完整的时间序列\nSELECT\n    time_series.day,\n    countIf(event_time >= time_series.day \n            AND e",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 7 天滑动窗口\nSELECT\n    event_time,\n    event_type,\n    count() OVER (\n        PARTITION BY event_type\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 创建表时物化日期列\nCREATE TABLE events_optimized (\n    id UInt64,\n    event_time DateTime,\n    event_date D",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询时使用预计算列（更快）\nSELECT\n    event_date,\n    count() AS event_count\nFROM events_optimized\nWHERE event_date >= today() - INTERVAL 30 DAY\nGROUP BY event_date\nORDER BY event_date",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 创建预聚合物化视图\nCREATE MATERIALIZED VIEW daily_stats_mv\nENGINE = AggregatingMergeTree()\nPARTITION BY toY",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询物化视图（极快）\nSELECT\n    event_date,\n    event_type,\n    countMerge(event_count_state) AS event_count,\n    avgMerge(avg_value_state) AS avg_value,\n    sumMerge(total_value_state) AS total_value\nFROM d",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 查询多个不连续的时间范围\nSELECT * FROM events\nWHERE event_time IN (\n    (SELECT toDateTime('2024-01-01 00:00:0",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 连接两个时间范围\nSELECT\n    a.event_time AS a_time,\n    b.event_time AS b_time,\n    dateDiff('second', a.e",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- 按时间分桶\nSELECT\n    intDiv(toUnixTimestamp(event_time), 3600) AS hour_bucket,  -- 每小时一个桶\n    count() ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 按天分桶\nSELECT\n    toDate(event_time) AS day_bucket,\n    count() AS event_count\nFROM events\nWHERE event_time >= now() - INTERVAL 30 DAY\nGROUP BY day_bucket\nORDER BY day_bucket",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- ❌ 错误：不使用时间函数，可能不准确\nSELECT * FROM events\nWHERE event_time >= '2024-01-01'\n  AND event_time < '2024-",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 正确：使用 toStartOfDay\nSELECT * FROM events\nWHERE event_time >= toStartOfDay(toDateTime('2024-01-01'))\n  AND event_time < toStartOfDay(toDateTime('2024-01-02'))",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- ❌ 错误：格式不匹配\nSELECT * FROM events\nWHERE event_time >= '01/20/2024'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 正确：使用标准格式\nSELECT * FROM events\nWHERE event_time >= '2024-01-20'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 简单范围查询\n-- ========================================\n\n-- ❌ 错误：不考虑时区\nSELECT * FROM events\nWHERE event_time >= '2024-01-20 00:00:00'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 正确：显式指定时区\nSELECT * FROM events\nWHERE event_time >= toDateTime('2024-01-20 00:00:00', 'UTC')",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "10-date-update\\06_date_formatting_examples.sql": [
      {
        "statement": "-- ================================================\n-- 06_date_formatting_examples.sql\n-- 从 06_date_formatting.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- ===========================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 常用格式\nSELECT\n    formatDateTime(now(), '%Y-%m-%d') AS date_only,\n    formatDateTime(now(), '%H:%M:%S') AS time_only,\n    formatDateTime(now(), '%Y-%m-%d %H:%M') AS datetime_minute,\n    formatDateTim",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 所有可用的占位符\nSELECT\n    formatDateTime(now(), '%Y') AS year,              -- 4 位年：2024\n    for",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 周数（1-53）：03\n\n-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- ISO 8601 日期时间\nSELECT\n    formatDateTime(now(), '%Y-%m-%dT%H:%M:%S') AS iso",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 中文格式\nSELECT\n    formatDateTime(now(), '%Y年%m月%d日') AS chinese_date,\n    formatDateTime(now",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 英文格式\nSELECT\n    formatDateTime(now(), '%B %d, %Y') AS us_date,\n    formatDateTime(now(), '%d %B %Y') AS uk_date,\n    formatDateTime(now(), '%A, %B %d, %Y') AS full_text",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 短格式\nSELECT\n    formatDateTime(now(), '%Y/%m/%d') AS short_date,\n    formatDateTime(now(), '%m/%d/%Y') AS us_short_date",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 24 小时制\nSELECT\n    formatDateTime(now(), '%H:%M') AS time_hm,\n    formatDateTime(now(), '%H",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 12 小时制\nSELECT\n    formatDateTime(now(), '%I:%M %p') AS time12,\n    formatDateTime(now(), '%I:%M:%S %p') AS time12_full",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 解析基本格式\nSELECT\n    parseDateTime('2024-01-20') AS date,\n    parseDateTime('2024-01-20 14:30",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 解析不同格式\nSELECT\n    parseDateTime('2024-01-20', '%Y-%m-%d') AS format1,\n    parseDateTime('01/20/2024', '%m/%d/%Y') AS format2,\n    parseDateTime('20-Jan-2024', '%d-%b-%Y') AS format3",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 智能解析（支持多种格式）\nSELECT\n    parseDateTimeBestEffort('2024-01-20') AS parsed1,\n    parseDateTim",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 解析 Unix 时间戳\nSELECT\n    parseDateTimeBestEffort('1705757696') AS parsed_ts",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 生成日报表\nSELECT\n    formatDateTime(event_time, '%Y-%m-%d') AS report_date,\n    event_type,\n  ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 生成日志文件名\nSELECT\n    concat(\n        'access_', \n        formatDateTime(event_time, '%Y%m%d'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 格式化 API 响应中的时间\nSELECT\n    id,\n    name,\n    formatDateTime(created_at, '%Y-%m-%dT%H:%M:%SZ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 导出 CSV 格式的时间\nSELECT\n    id,\n    event_time,\n    formatDateTime(event_time, '%Y-%m-%d %H:%M",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 多语言日期显示\nSELECT\n    formatDateTime(now(), '%Y年%m月%d日') AS chinese,\n    formatDateTime(now()",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 创建自定义格式化函数\nCREATE FUNCTION formatChineseDate AS (d) -> \n    formatDateTime(d, '%Y年%m月%d日')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "CREATE FUNCTION formatFriendlyTime AS (dt) -> \n    if(dateDiff('day', dt, now()) < 1,\n        concat(dateDiff('hour', dt, now()), ' hours ago'),\n        if(dateDiff('day', dt, now()) < 7,\n            ",
        "success": true,
        "result": ""
      },
      {
        "statement": "-- 使用自定义函数\nSELECT\n    formatChineseDate(event_time) AS chinese_date,\n    formatFriendlyTime(event_time) AS friendly_time\nFROM events\nLIMIT 10",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- 根据时间差格式化\nSELECT\n    event_time,\n    case\n        when dateDiff('minute', event_time, now()",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- ❌ 错误：格式不匹配\nSELECT parseDateTime('2024/01/20', '%Y-%m-%d')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 失败\n\n-- ✅ 正确：匹配格式\nSELECT parseDateTime('2024/01/20', '%Y/%m/%d')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 成功\n\n-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- ❌ 错误：不考虑时区\nSELECT formatDateTime(now(), '%Y-%m-%d %H:%M:%S')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 使用服务器时区，可能不是期望的\n\n-- ✅ 正确：转换时区后格式化\nSELECT formatDateTime(toTimezone(now(), 'Asia/Shanghai'), '%Y-%m-%d %H:%M:%S')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- formatDateTime\n-- ========================================\n\n-- ❌ 错误：在查询中重复格式化\nSELECT \n    formatDateTime(event_time, '%Y-%m-%d') AS date,\n    count() AS ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 正确：预计算日期列\nSELECT \n    event_date,\n    count() AS cnt\nFROM events\nWHERE event_date = '2024-01-20'\nGROUP BY event_date",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "10-date-update\\07_time_series_analysis_examples.sql": [
      {
        "statement": "-- ================================================\n-- 07_time_series_analysis_examples.sql\n-- 从 07_time_series_analysis.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- =================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 查询最近的数据\nSELECT\n    timestamp,\n    metric_name,\n    value\nFROM time_series\nWHERE timestamp >= now",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 按不同时间粒度聚合\n-- 按分钟聚合\nSELECT\n    toStartOfMinute(timestamp) AS minute,\n    metric_name,\n    avg(val",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 按小时聚合\nSELECT\n    toStartOfHour(timestamp) AS hour,\n    metric_name,\n    avg(value) AS avg_value,\n    count() AS sample_count\nFROM time_series\nWHERE timestamp >= now() - INTERVAL 7 DAY\nGROUP BY hour",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 按天聚合\nSELECT\n    toDate(timestamp) AS day,\n    metric_name,\n    avg(value) AS avg_value,\n    count() AS sample_count\nFROM time_series\nWHERE timestamp >= now() - INTERVAL 30 DAY\nGROUP BY day, metric_",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 计算标准差\nSELECT\n    toStartOfHour(timestamp) AS hour,\n    metric_name,\n    avg(value) AS avg_value,",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 计算变化率\nSELECT\n    toStartOfHour(timestamp) AS hour,\n    metric_name,\n    avg(value) AS avg_value,\n    avg(value) - lagInFrame(avg(value)) OVER (\n        PARTITION BY metric_name\n        ORDER BY hou",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 滚动平均\nSELECT\n    timestamp,\n    metric_name,\n    value,\n    avg(value) OVER (\n        PARTITION B",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 时间范围窗口（秒）\nSELECT\n    timestamp,\n    metric_name,\n    value,\n    avg(value) OVER (\n        PARTIT",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 计算趋势（线性回归）\nSELECT\n    metric_name,\n    avg(value) AS avg_value,\n    min(value) AS min_value,\n   ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 使用统计方法检测异常\nSELECT\n    timestamp,\n    metric_name,\n    value,\n    avg_value,\n    stddev_value,\n  ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 使用 arrayJoin 填充缺失的时间点\nSELECT\n    time_series.timestamp,\n    time_series.metric_name,\n    time_se",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 连接多个时间序列\nSELECT\n    t1.timestamp,\n    t1.metric_name AS metric1,\n    t1.value AS value1,\n    t2.",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 降采样（减少数据点）\n-- 按小时降采样（使用平均值）\nCREATE MATERIALIZED VIEW time_series_hourly_mv\nENGINE = AggregatingM",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询降采样数据\nSELECT\n    hour_timestamp,\n    metric_name,\n    avgMerge(avg_value_state) AS avg_value,\n    minMerge(min_value_state) AS min_value,\n    maxMerge(max_value_state) AS max_value,\n    countMerg",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 分析日季节性\nSELECT\n    toHour(timestamp) AS hour,\n    avg(value) AS avg_value,\n    count() AS sample_",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 分析周季节性\nSELECT\n    toDayOfWeek(timestamp) AS day_of_week,\n    avg(value) AS avg_value,\n    count() AS sample_count\nFROM time_series\nWHERE timestamp >= now() - INTERVAL 12 WEEK\nGROUP BY day_of_week\nO",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 简单的移动平均预测\nSELECT\n    timestamp,\n    value,\n    avg(value) OVER (\n        PARTITION BY metric_nam",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- 创建多粒度聚合物化视图\n\n-- 1 分钟粒度\nCREATE MATERIALIZED VIEW time_series_1m_mv\nENGINE = AggregatingMergeTree(",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 5 分钟粒度\nCREATE MATERIALIZED VIEW time_series_5m_mv\nENGINE = AggregatingMergeTree()\nPARTITION BY toYYYYMM(five_minute_ts)\nORDER BY (metric_name, five_minute_ts)\nAS SELECT\n    toStartOfFiveMinutes(tim",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 1 小时粒度\nCREATE MATERIALIZED VIEW time_series_1h_mv\nENGINE = AggregatingMergeTree()\nPARTITION BY toYYYYMM(hour_ts)\nORDER BY (metric_name, hour_ts)\nAS SELECT\n    toStartOfHour(timestamp) AS hour_ts,\n ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- ❌ 错误：不检查数据间隔\nSELECT avg(value) FROM time_series\nWHERE timestamp >= now() - INTERVAL 1 HOUR",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 正确：考虑数据间隔\nSELECT \n    count() AS sample_count,\n    max(timestamp) - min(timestamp) AS time_span_seconds,\n    avg(value) AS avg_value\nFROM time_series\nWHERE timestamp >= now() - INTERVAL 1 HOUR",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 时间序列数据特征\n-- ========================================\n\n-- ❌ 错误：不处理不对齐的时间点\nSELECT t1.value - t2.value AS diff\nFROM time_series t1\nJOIN time_series t2 ON t1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 正确：使用时间范围窗口\nSELECT \n    t1.timestamp,\n    t1.value - t2.value AS diff\nFROM time_series t1\nASOF LEFT JOIN time_series t2 \n    ON t1.metric_name = t2.metric_name\n    AND t2.timestamp >= t1.timestam",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "10-date-update\\08_window_functions_examples.sql": [
      {
        "statement": "-- ================================================\n-- 08_window_functions_examples.sql\n-- 从 08_window_functions.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- =========================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 简单滚动平均\nSELECT\n    event_time,\n    value,\n    avg(value) OVER (\n        ORDER BY event_time\n        R",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 滚动求和\nSELECT\n    event_time,\n    value,\n    sum(value) OVER (\n        ORDER BY event_time\n        ROW",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 时间范围窗口（秒）\nSELECT\n    event_time,\n    value,\n    avg(value) OVER (\n        ORDER BY event_time\n      ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- LAG：访问前一行的值\nSELECT\n    event_time,\n    value,\n    lagInFrame(value, 1) OVER (ORDER BY event_time) AS",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- LEAD：访问后一行的值\nSELECT\n    event_time,\n    value,\n    leadInFrame(value, 1) OVER (ORDER BY event_time) AS next_value,\n    leadInFrame(value, 5) OVER (ORDER BY event_time) AS next_value_5,\n    leadInFr",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 计算事件间隔\nSELECT\n    event_time,\n    lagInFrame(event_time, 1) OVER (\n        PARTITION BY user_id\n    ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 行编号\nSELECT\n    user_id,\n    score,\n    row_number() OVER (\n        PARTITION BY user_id\n        ORDE",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 使用窗口函数计算分位数\nSELECT\n    toStartOfMinute(event_time) AS minute,\n    metric_name,\n    value,\n    quanti",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 年初至今（YTD）累计\nSELECT\n    event_time,\n    amount,\n    sum(amount) OVER (\n        PARTITION BY toYear(ev",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 滚动最大值\nSELECT\n    event_time,\n    value,\n    max(value) OVER (\n        ORDER BY event_time\n        RO",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 识别用户会话（5 分钟内的事件）\nSELECT\n    user_id,\n    event_time,\n    lagInFrame(event_time, 1) OVER (\n        PA",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 周环比\nSELECT\n    event_date,\n    metric_name,\n    value,\n    lagInFrame(value, 7) OVER (\n        PARTI",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 基于统计的异常检测\nSELECT\n    event_time,\n    value,\n    avg(value) OVER (\n        ORDER BY event_time\n      ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 使用 FRAME 窗口函数\nSELECT\n    event_time,\n    value,\n    avg(value) OVER (\n        ORDER BY event_time\n  ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 自定义窗口大小\nSELECT\n    event_time,\n    value,\n    avg(value) OVER (\n        ORDER BY event_time\n        ",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 基本语法\n-- ========================================\n\n-- 物化常用的窗口计算\nCREATE MATERIALIZED VIEW rolling_metrics_mv\nENGINE = AggregatingMergeTree()\nPARTITION BY t",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询物化视图\nSELECT\n    window_time,\n    metric_name,\n    avgMerge(avg_value_state) AS avg_value,\n    minMerge(min_value_state) AS min_value,\n    maxMerge(max_value_state) AS max_value,\n    countMerge(co",
        "success": true,
        "result": "Comment - skipped"
      }
    ],
    "10-date-update\\09_date_performance_examples.sql": [
      {
        "statement": "-- ================================================\n-- 09_date_performance_examples.sql\n-- 从 09_date_performance.md 提取的 SQL 示例\n-- 提取时间: 2026-01-23 14:40:17\n-- =========================================",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 存储效率\n-- ========================================\n\n-- 比较不同查询方式的性能\nSELECT \n    'Date comparison' AS query_type,\n    count() AS result\nFROM test_table\nWHERE",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 存储效率\n-- ========================================\n\n-- ✅ 优化：只存储日期时使用 Date 类型\nCREATE TABLE events_optimized (\n    id UInt64,\n    event_date Date,  -- 只需要日期\n",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询性能更好\nSELECT * FROM events_optimized\nWHERE event_date = '2024-01-20'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 存储效率\n-- ========================================\n\n-- ✅ 优化：物化常用的时间列\nCREATE TABLE events (\n    id UInt64,\n    event_time DateTime,\n    event_date Date MATE",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询时使用物化列（更快）\nSELECT\n    event_date,\n    event_year,\n    event_month,\n    count() AS event_count\nFROM events\nWHERE event_date >= today() - INTERVAL 30 DAY\nGROUP BY event_date, event_year, event_mont",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 存储效率\n-- ========================================\n\n-- ✅ 优化：使用时间作为分区键\nCREATE TABLE events_partitioned (\n    id UInt64,\n    event_time DateTime,\n    event_d",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询自动使用分区裁剪\nSELECT * FROM events_partitioned\nWHERE event_time >= '2024-01-01'\n  AND event_time < '2024-02-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 只扫描 1 个分区\n\n-- ========================================\n-- 存储效率\n-- ========================================\n\n-- ✅ 优化：创建预聚合物化视图\nCREATE MATERIALIZED VIEW daily_events_mv\nENGINE = AggregatingMergeTree(",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询物化视图（极快）\nSELECT\n    event_date,\n    event_type,\n    countMerge(event_count_state) AS event_count,\n    avgMerge(avg_value_state) AS avg_value,\n    sumMerge(total_value_state) AS total_value\nFROM d",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 存储效率\n-- ========================================\n\n-- ✅ 优化：为时间列创建跳数索引\nCREATE TABLE events (\n    id UInt64,\n    event_time DateTime,\n    event_date Date MA",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 添加跳数索引\nALTER TABLE events \nADD INDEX idx_event_date event_date TYPE minmax GRANULARITY 4",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "ALTER TABLE events \nADD INDEX idx_event_type event_type TYPE set(0) GRANULARITY 4",
        "success": false,
        "result": "HTTP 404: Code: 60. DB::Exception: Could not find table: events. (UNKNOWN_TABLE) (version 25.12.3.21 (official build))\n"
      },
      {
        "statement": "-- 查询时自动使用索引\nSELECT * FROM events\nWHERE event_date >= '2024-01-01'\n  AND event_date < '2024-02-01'\n  AND event_type = 'login'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 存储效率\n-- ========================================\n\n-- ❌ 慢：在 WHERE 子句中使用函数\nSELECT * FROM events\nWHERE toDate(event_time) = '2024-01-20'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 快：使用物化列或预计算值\nSELECT * FROM events\nWHERE event_date = '2024-01-20'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 使用物化列\n\n-- ========================================\n-- 存储效率\n-- ========================================\n\n-- ❌ 慢：使用等值查询\nSELECT * FROM events\nWHERE event_time = toDateTime('2024-01-20 12:00:00')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 快：使用时间范围\nSELECT * FROM events\nWHERE event_time >= toDateTime('2024-01-20 12:00:00')\n  AND event_time < toDateTime('2024-01-20 12:01:00')",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 存储效率\n-- ========================================\n\n-- ✅ 优化：利用分区裁剪\nSELECT * FROM events\nWHERE event_time >= '2024-01-01'\n  AND event_time < '2024-02-01'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 只扫描 1 个分区\n\n-- ❌ 慢：跨多个分区查询\nSELECT * FROM events\nWHERE event_time >= '2024-01-15'\n  AND event_time < '2024-02-15'",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 扫描 2 个分区\n\n-- ========================================\n-- 存储效率\n-- ========================================\n\n-- 查看查询执行计划\nEXPLAIN PIPELINE\nSELECT\n    event_date,\n    count() AS event_count\nFROM events",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 存储效率\n-- ========================================\n\n-- 查看查询扫描的数据量\nSELECT\n    read_rows AS rows_read,\n    read_bytes AS bytes_read,\n    result_rows AS rows_",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 存储效率\n-- ========================================\n\n-- 优化的时间序列表设计\nCREATE TABLE time_series_optimized (\n    metric_name String,\n    timestamp DateTime64(3),",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 添加跳数索引\nALTER TABLE time_series_optimized\nADD INDEX idx_metric_name metric_name TYPE set(0) GRANULARITY 1",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询时使用物化列\nSELECT\n    metric_name,\n    date,\n    hour,\n    avg(value) AS avg_value,\n    count() AS sample_count\nFROM time_series_optimized\nWHERE date >= today() - INTERVAL 30 DAY\nGROUP BY metric_name",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 存储效率\n-- ========================================\n\n-- 创建多粒度物化视图\n\n-- 1 分钟粒度\nCREATE MATERIALIZED VIEW metrics_1m_mv\nENGINE = AggregatingMergeTree()\nPARTITIO",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 5 分钟粒度\nCREATE MATERIALIZED VIEW metrics_5m_mv\nENGINE = AggregatingMergeTree()\nPARTITION BY toYYYYMM(timestamp)\nORDER BY (metric_name, tags, timestamp)\nAS SELECT\n    metric_name,\n    tags,\n    toSta",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 1 小时粒度\nCREATE MATERIALIZED VIEW metrics_1h_mv\nENGINE = AggregatingMergeTree()\nPARTITION BY toYYYYMM(timestamp)\nORDER BY (metric_name, tags, timestamp)\nAS SELECT\n    metric_name,\n    tags,\n    toSta",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ========================================\n-- 存储效率\n-- ========================================\n\n-- ❌ 慢：复杂的时间计算\nSELECT\n    toStartOfDay(event_time) AS day,\n    countIf(toHour(event_time) >= 8 AND toHo",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- ✅ 快：使用物化列\nCREATE TABLE events_optimized (\n    id UInt64,\n    event_time DateTime,\n    event_date Date MATERIALIZED toDate(event_time),\n    event_hour UInt8 MATERIALIZED toHour(event_time),\n    is_w",
        "success": true,
        "result": "Comment - skipped"
      },
      {
        "statement": "-- 查询使用物化列\nSELECT\n    event_date AS day,\n    sumIf(is_work_hour, 1, 0) AS work_hours_count,\n    sumIf(is_work_hour = 0, 1, 0) AS off_hours_count\nFROM events_optimized\nWHERE event_date >= today() - INT",
        "success": true,
        "result": "Comment - skipped"
      }
    ]
  }
}